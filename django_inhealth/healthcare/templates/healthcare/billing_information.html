{% extends 'healthcare/base.html' %}

{% block title %}Billing Information - InHealth EHR{% endblock %}

{% block breadcrumbs %}
&rsaquo; <a href="{% url 'index' %}">Dashboard</a>
&rsaquo; Billing Information
{% endblock %}

{% block extra_css %}
<style>
    /* Modern font stack */
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    .billing-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 0 20px 40px;
    }

    .billing-header {
        background: linear-gradient(135deg, #059669 0%, #047857 100%);
        color: white;
        padding: 32px 36px;
        border-radius: 12px;
        margin-bottom: 36px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .billing-header h1 {
        margin: 0 0 8px 0;
        font-size: 24px;
        font-weight: 600;
        letter-spacing: -0.02em;
    }

    .billing-header p {
        margin: 0;
        font-size: 13px;
        opacity: 0.92;
        line-height: 1.6;
    }

    .progress-container {
        background: white;
        padding: 20px 24px;
        border-radius: 10px;
        margin-bottom: 28px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.06);
        border: 1px solid #e5e7eb;
    }

    .progress-bar {
        width: 100%;
        height: 6px;
        background: #e5e7eb;
        border-radius: 3px;
        overflow: hidden;
        margin-bottom: 8px;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #059669 0%, #047857 100%);
        width: 0%;
        transition: width 0.3s ease;
    }

    .progress-text {
        text-align: center;
        color: #6b7280;
        font-size: 12px;
        font-weight: 500;
    }

    .billing-section {
        background: white;
        padding: 28px 32px 32px;
        border-radius: 10px;
        margin-bottom: 28px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.06);
        border: 1px solid #e5e7eb;
    }

    .section-header {
        display: flex;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 1px solid #e5e7eb;
    }

    .section-number {
        background: linear-gradient(135deg, #059669 0%, #047857 100%);
        color: white;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        margin-right: 12px;
        font-size: 14px;
        flex-shrink: 0;
    }

    .section-title {
        font-size: 17px;
        font-weight: 600;
        color: #1f2937;
        margin: 0;
        letter-spacing: -0.01em;
    }

    .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 20px;
        margin-bottom: 18px;
    }

    .form-group {
        margin-bottom: 18px;
    }

    .form-label {
        display: block;
        font-weight: 500;
        color: #374151;
        margin-bottom: 7px;
        font-size: 13px;
    }

    .required-mark {
        color: #dc2626;
        margin-left: 3px;
        font-size: 12px;
    }

    .text-input,
    .date-input,
    .number-input,
    .select-input,
    .textarea-input {
        width: 100%;
        padding: 9px 12px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 13px;
        transition: all 0.15s ease;
        box-sizing: border-box;
        font-family: inherit;
    }

    .text-input:focus,
    .date-input:focus,
    .number-input:focus,
    .select-input:focus,
    .textarea-input:focus {
        outline: none;
        border-color: #059669;
        box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.08);
    }

    .textarea-input {
        resize: vertical;
        min-height: 72px;
        line-height: 1.5;
    }

    .radio-group,
    .checkbox-group {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        margin-top: 8px;
    }

    .radio-item,
    .checkbox-item {
        display: flex;
        align-items: center;
        gap: 7px;
    }

    .radio-item input[type="radio"],
    .checkbox-item input[type="checkbox"] {
        width: 16px;
        height: 16px;
        cursor: pointer;
        accent-color: #059669;
    }

    .radio-item label,
    .checkbox-item label {
        cursor: pointer;
        font-size: 13px;
        color: #374151;
    }

    .input-hint {
        font-size: 11px;
        color: #6b7280;
        margin-top: 5px;
        font-style: italic;
        line-height: 1.4;
    }

    .info-box {
        background: #eff6ff;
        border-left: 3px solid #3b82f6;
        padding: 14px 16px;
        border-radius: 6px;
        margin-bottom: 20px;
    }

    .info-box p {
        margin: 0;
        color: #1e40af;
        font-size: 12px;
        line-height: 1.5;
    }

    .warning-box {
        background: #fffbeb;
        border-left: 3px solid #f59e0b;
        padding: 14px 16px;
        border-radius: 6px;
        margin-bottom: 20px;
    }

    .warning-box p {
        margin: 0;
        color: #78350f;
        font-size: 12px;
        line-height: 1.5;
    }

    .success-box {
        background: #f0fdf4;
        border-left: 3px solid #059669;
        padding: 14px 16px;
        border-radius: 6px;
        margin-bottom: 20px;
    }

    .success-box p {
        margin: 0;
        color: #065f46;
        font-size: 12px;
        line-height: 1.5;
    }

    .payment-method-card {
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        background: #f9fafb;
    }

    .payment-method-card h4 {
        margin: 0 0 14px 0;
        color: #059669;
        font-size: 14px;
        font-weight: 600;
    }

    .card-icons {
        display: flex;
        gap: 8px;
        margin-bottom: 14px;
        align-items: center;
    }

    .card-icon {
        font-size: 24px;
    }

    .subsection-title {
        font-size: 14px;
        font-weight: 600;
        color: #059669;
        margin: 24px 0 14px 0;
        padding-bottom: 8px;
        border-bottom: 1px solid #e5e7eb;
    }

    .submit-container {
        background: white;
        padding: 28px 32px;
        border-radius: 10px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.06);
        border: 1px solid #e5e7eb;
        margin-top: 28px;
        text-align: center;
    }

    .submit-button {
        background: linear-gradient(135deg, #059669 0%, #047857 100%);
        color: white;
        padding: 10px 28px;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 2px 4px rgba(5, 150, 105, 0.15);
        letter-spacing: -0.01em;
    }

    .submit-button:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(5, 150, 105, 0.25);
    }

    .submit-button:active {
        transform: translateY(0);
    }

    .optional-label {
        color: #9ca3af;
        font-size: 12px;
        font-weight: normal;
        margin-left: 6px;
    }

    .payment-plan-option {
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 16px 18px;
        margin-bottom: 12px;
        cursor: pointer;
        transition: all 0.15s ease;
        background: white;
    }

    .payment-plan-option:hover {
        border-color: #059669;
        background-color: #f0fdf4;
    }

    .payment-plan-option.selected {
        border-color: #059669;
        background-color: #ecfdf5;
        box-shadow: 0 0 0 1px #059669;
    }

    .plan-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 6px;
    }

    .plan-name {
        font-weight: 600;
        font-size: 14px;
        color: #1f2937;
    }

    .plan-amount {
        font-size: 14px;
        font-weight: 600;
        color: #059669;
    }

    .plan-description {
        font-size: 12px;
        color: #6b7280;
        margin: 0;
        line-height: 1.4;
    }

    .guarantor-same-checkbox {
        background: #f0fdf4;
        border: 1px solid #d1fae5;
        padding: 14px 16px;
        border-radius: 6px;
        margin-bottom: 20px;
    }

    /* Responsive improvements */
    @media (max-width: 640px) {
        .billing-container {
            padding: 0 16px 32px;
        }

        .billing-header {
            padding: 24px 20px;
        }

        .billing-header h1 {
            font-size: 20px;
        }

        .billing-section {
            padding: 20px 20px 24px;
        }

        .section-title {
            font-size: 16px;
        }

        .form-row {
            grid-template-columns: 1fr;
            gap: 16px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="billing-container">
    <div class="billing-header">
        <h1>üí∞ Billing Information</h1>
        <p>Please provide your billing information to ensure accurate invoicing and payment processing. All payment information is securely encrypted and protected.</p>
    </div>

    <div class="progress-container">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText">0% Complete</div>
    </div>

    <form method="post" id="billingForm">
        {% csrf_token %}

        <!-- Section 1: Billing Contact Information -->
        <div class="billing-section">
            <div class="section-header">
                <div class="section-number">1</div>
                <h2 class="section-title">Billing Contact Information</h2>
            </div>

            <div class="info-box">
                <p><strong>Important:</strong> This is the person/entity responsible for payment. Billing statements and payment reminders will be sent to this contact.</p>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">First Name <span class="required-mark">*</span></label>
                    <input type="text" name="billing_first_name" class="text-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Last Name <span class="required-mark">*</span></label>
                    <input type="text" name="billing_last_name" class="text-input" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Email Address <span class="required-mark">*</span></label>
                    <input type="email" name="billing_email" class="text-input" required placeholder="email@example.com">
                    <div class="input-hint">Bills and receipts will be sent to this email</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Phone Number <span class="required-mark">*</span></label>
                    <input type="tel" name="billing_phone" class="text-input" required placeholder="(555) 555-5555">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Street Address <span class="required-mark">*</span></label>
                <input type="text" name="billing_address_line1" class="text-input" required placeholder="Street address, P.O. box">
            </div>

            <div class="form-group">
                <label class="form-label">Address Line 2</label>
                <input type="text" name="billing_address_line2" class="text-input" placeholder="Apartment, suite, unit, building, floor, etc.">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">City <span class="required-mark">*</span></label>
                    <input type="text" name="billing_city" class="text-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">State/Province <span class="required-mark">*</span></label>
                    <select name="billing_state" class="select-input" required>
                        <option value="">Select state...</option>
                        <option value="AL">Alabama</option>
                        <option value="AK">Alaska</option>
                        <option value="AZ">Arizona</option>
                        <option value="AR">Arkansas</option>
                        <option value="CA">California</option>
                        <option value="CO">Colorado</option>
                        <option value="CT">Connecticut</option>
                        <option value="DE">Delaware</option>
                        <option value="FL">Florida</option>
                        <option value="GA">Georgia</option>
                        <option value="HI">Hawaii</option>
                        <option value="ID">Idaho</option>
                        <option value="IL">Illinois</option>
                        <option value="IN">Indiana</option>
                        <option value="IA">Iowa</option>
                        <option value="KS">Kansas</option>
                        <option value="KY">Kentucky</option>
                        <option value="LA">Louisiana</option>
                        <option value="ME">Maine</option>
                        <option value="MD">Maryland</option>
                        <option value="MA">Massachusetts</option>
                        <option value="MI">Michigan</option>
                        <option value="MN">Minnesota</option>
                        <option value="MS">Mississippi</option>
                        <option value="MO">Missouri</option>
                        <option value="MT">Montana</option>
                        <option value="NE">Nebraska</option>
                        <option value="NV">Nevada</option>
                        <option value="NH">New Hampshire</option>
                        <option value="NJ">New Jersey</option>
                        <option value="NM">New Mexico</option>
                        <option value="NY">New York</option>
                        <option value="NC">North Carolina</option>
                        <option value="ND">North Dakota</option>
                        <option value="OH">Ohio</option>
                        <option value="OK">Oklahoma</option>
                        <option value="OR">Oregon</option>
                        <option value="PA">Pennsylvania</option>
                        <option value="RI">Rhode Island</option>
                        <option value="SC">South Carolina</option>
                        <option value="SD">South Dakota</option>
                        <option value="TN">Tennessee</option>
                        <option value="TX">Texas</option>
                        <option value="UT">Utah</option>
                        <option value="VT">Vermont</option>
                        <option value="VA">Virginia</option>
                        <option value="WA">Washington</option>
                        <option value="WV">West Virginia</option>
                        <option value="WI">Wisconsin</option>
                        <option value="WY">Wyoming</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">ZIP/Postal Code <span class="required-mark">*</span></label>
                    <input type="text" name="billing_zip" class="text-input" required placeholder="12345">
                </div>
                <div class="form-group">
                    <label class="form-label">Country <span class="required-mark">*</span></label>
                    <select name="billing_country" class="select-input" required>
                        <option value="USA">United States</option>
                        <option value="Canada">Canada</option>
                        <option value="Mexico">Mexico</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Section 2: Guarantor Information -->
        <div class="billing-section">
            <div class="section-header">
                <div class="section-number">2</div>
                <h2 class="section-title">Guarantor Information</h2>
            </div>

            <div class="info-box">
                <p><strong>Guarantor</strong> is the person legally responsible for payment of medical bills. This is typically the patient, parent (for minors), or guardian.</p>
            </div>

            <div class="guarantor-same-checkbox">
                <div class="checkbox-item">
                    <input type="checkbox" name="guarantor_same_as_patient" value="yes" id="guarantor-same">
                    <label for="guarantor-same"><strong>Guarantor is the same as the patient</strong></label>
                </div>
            </div>

            <div id="guarantorDetails">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Guarantor First Name <span class="required-mark">*</span></label>
                        <input type="text" name="guarantor_first_name" class="text-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Guarantor Last Name <span class="required-mark">*</span></label>
                        <input type="text" name="guarantor_last_name" class="text-input" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Relationship to Patient <span class="required-mark">*</span></label>
                        <select name="guarantor_relationship" class="select-input" required>
                            <option value="">Select relationship...</option>
                            <option value="self">Self (Patient)</option>
                            <option value="parent">Parent</option>
                            <option value="spouse">Spouse</option>
                            <option value="guardian">Legal Guardian</option>
                            <option value="child">Child</option>
                            <option value="sibling">Sibling</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Date of Birth <span class="required-mark">*</span></label>
                        <input type="date" name="guarantor_dob" class="date-input" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Social Security Number</label>
                        <input type="text" name="guarantor_ssn" class="text-input" placeholder="XXX-XX-XXXX" maxlength="11">
                        <div class="input-hint">Optional but may be required for credit verification</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phone Number <span class="required-mark">*</span></label>
                        <input type="tel" name="guarantor_phone" class="text-input" required placeholder="(555) 555-5555">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" name="guarantor_email" class="text-input" placeholder="email@example.com">
                </div>

                <h3 class="subsection-title">Guarantor Address</h3>

                <div class="guarantor-same-checkbox">
                    <div class="checkbox-item">
                        <input type="checkbox" name="guarantor_address_same_as_billing" value="yes" id="guarantor-address-same">
                        <label for="guarantor-address-same"><strong>Same as billing address</strong></label>
                    </div>
                </div>

                <div id="guarantorAddressFields">
                    <div class="form-group">
                        <label class="form-label">Street Address</label>
                        <input type="text" name="guarantor_address_line1" class="text-input">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Address Line 2</label>
                        <input type="text" name="guarantor_address_line2" class="text-input">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">City</label>
                            <input type="text" name="guarantor_city" class="text-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">State</label>
                            <input type="text" name="guarantor_state" class="text-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ZIP Code</label>
                            <input type="text" name="guarantor_zip" class="text-input">
                        </div>
                    </div>
                </div>

                <h3 class="subsection-title">Guarantor Employment (Optional)</h3>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Employer Name</label>
                        <input type="text" name="guarantor_employer" class="text-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Employer Phone</label>
                        <input type="tel" name="guarantor_employer_phone" class="text-input">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Annual Income (Optional)</label>
                        <select name="guarantor_income_range" class="select-input">
                            <option value="">Select income range...</option>
                            <option value="under_25k">Under $25,000</option>
                            <option value="25k_50k">$25,000 - $50,000</option>
                            <option value="50k_75k">$50,000 - $75,000</option>
                            <option value="75k_100k">$75,000 - $100,000</option>
                            <option value="100k_150k">$100,000 - $150,000</option>
                            <option value="150k_plus">Over $150,000</option>
                        </select>
                        <div class="input-hint">Used to determine financial assistance eligibility</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Number of Dependents</label>
                        <input type="number" name="guarantor_dependents" class="number-input" min="0" placeholder="0">
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 3: Payment Methods -->
        <div class="billing-section">
            <div class="section-header">
                <div class="section-number">3</div>
                <h2 class="section-title">Payment Methods</h2>
            </div>

            <div class="warning-box">
                <p><strong>Security:</strong> All payment information is encrypted using industry-standard PCI DSS compliant security measures.</p>
            </div>

            <div class="form-group">
                <label class="form-label">Preferred Payment Method <span class="required-mark">*</span></label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" name="payment_method" value="credit_card" id="pay-credit" required>
                        <label for="pay-credit">Credit/Debit Card</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" name="payment_method" value="bank_account" id="pay-bank">
                        <label for="pay-bank">Bank Account (ACH)</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" name="payment_method" value="check" id="pay-check">
                        <label for="pay-check">Check/Money Order</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" name="payment_method" value="cash" id="pay-cash">
                        <label for="pay-cash">Cash</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" name="payment_method" value="other" id="pay-other">
                        <label for="pay-other">Other</label>
                    </div>
                </div>
            </div>

            <!-- Credit/Debit Card Information -->
            <div id="creditCardDetails" style="display: none;">
                <div class="payment-method-card">
                    <h4>üí≥ Credit/Debit Card Information</h4>

                    <div class="card-icons">
                        <span class="card-icon" title="Visa">üí≥</span>
                        <span style="font-size: 10px; color: #6b7280;">We accept Visa, Mastercard, American Express, and Discover</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Cardholder Name <span class="required-mark">*</span></label>
                        <input type="text" name="card_holder_name" class="text-input" placeholder="Name as it appears on card">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Card Number <span class="required-mark">*</span></label>
                        <input type="text" name="card_number" class="text-input" placeholder="1234 5678 9012 3456" maxlength="19">
                        <div class="input-hint">16-digit card number on the front of your card</div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Expiration Date <span class="required-mark">*</span></label>
                            <input type="text" name="card_expiry" class="text-input" placeholder="MM/YY" maxlength="5">
                        </div>
                        <div class="form-group">
                            <label class="form-label">CVV/Security Code <span class="required-mark">*</span></label>
                            <input type="text" name="card_cvv" class="text-input" placeholder="123" maxlength="4">
                            <div class="input-hint">3-digit code on back of card (4 for Amex)</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Billing ZIP Code for Card</label>
                        <input type="text" name="card_billing_zip" class="text-input" placeholder="12345">
                        <div class="input-hint">ZIP code associated with your card's billing address</div>
                    </div>
                </div>
            </div>

            <!-- Bank Account Information -->
            <div id="bankAccountDetails" style="display: none;">
                <div class="payment-method-card">
                    <h4>üè¶ Bank Account Information (ACH)</h4>

                    <div class="info-box">
                        <p>ACH payments are typically processed within 2-3 business days. Have your checkbook or bank statement handy.</p>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Account Holder Name <span class="required-mark">*</span></label>
                        <input type="text" name="bank_account_holder" class="text-input" placeholder="Name on bank account">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Bank Name <span class="required-mark">*</span></label>
                        <input type="text" name="bank_name" class="text-input" placeholder="Bank of America">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Account Type <span class="required-mark">*</span></label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" name="bank_account_type" value="checking" id="bank-checking">
                                <label for="bank-checking">Checking</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="bank_account_type" value="savings" id="bank-savings">
                                <label for="bank-savings">Savings</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Routing Number <span class="required-mark">*</span></label>
                            <input type="text" name="bank_routing_number" class="text-input" placeholder="123456789" maxlength="9">
                            <div class="input-hint">9-digit routing number on your check</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Account Number <span class="required-mark">*</span></label>
                            <input type="text" name="bank_account_number" class="text-input" placeholder="123456789012">
                            <div class="input-hint">Account number on your check or statement</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Confirm Account Number <span class="required-mark">*</span></label>
                        <input type="text" name="bank_account_number_confirm" class="text-input" placeholder="Re-enter account number">
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 4: Payment Preferences -->
        <div class="billing-section">
            <div class="section-header">
                <div class="section-number">4</div>
                <h2 class="section-title">Payment Preferences</h2>
            </div>

            <div class="form-group">
                <label class="form-label">Would you like to set up automatic payments?</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" name="auto_pay" value="yes" id="autopay-yes">
                        <label for="autopay-yes">Yes, automatically charge my payment method</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" name="auto_pay" value="no" id="autopay-no">
                        <label for="autopay-no">No, I will pay manually</label>
                    </div>
                </div>
                <div class="input-hint">Automatic payments help ensure you never miss a payment</div>
            </div>

            <div class="form-group">
                <label class="form-label">Billing Statement Preference <span class="required-mark">*</span></label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" name="statement_preference" value="email" id="statement-email" required>
                        <label for="statement-email">Email (Paperless)</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" name="statement_preference" value="mail" id="statement-mail">
                        <label for="statement-mail">Mail (Paper)</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" name="statement_preference" value="both" id="statement-both">
                        <label for="statement-both">Both Email and Mail</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" name="statement_preference" value="portal" id="statement-portal">
                        <label for="statement-portal">Patient Portal Only</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Payment Reminders</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" name="reminder_email" value="yes" id="reminder-email">
                        <label for="reminder-email">Email Reminders</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" name="reminder_sms" value="yes" id="reminder-sms">
                        <label for="reminder-sms">SMS/Text Reminders</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" name="reminder_phone" value="yes" id="reminder-phone">
                        <label for="reminder-phone">Phone Call Reminders</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">When would you like to receive payment reminders?</label>
                <select name="reminder_timing" class="select-input">
                    <option value="7_days">7 days before due date</option>
                    <option value="5_days">5 days before due date</option>
                    <option value="3_days" selected>3 days before due date</option>
                    <option value="1_day">1 day before due date</option>
                    <option value="no_reminder">No reminders</option>
                </select>
            </div>
        </div>

        <!-- Section 5: Payment Plans & Financial Assistance -->
        <div class="billing-section">
            <div class="section-header">
                <div class="section-number">5</div>
                <h2 class="section-title">Payment Plans & Financial Assistance</h2>
            </div>

            <div class="success-box">
                <p><strong>We're here to help!</strong> We offer flexible payment plans and financial assistance programs for qualified patients. Don't hesitate to ask about options that work for your budget.</p>
            </div>

            <div class="form-group">
                <label class="form-label">Are you interested in a payment plan?</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" name="interested_payment_plan" value="yes" id="plan-yes">
                        <label for="plan-yes">Yes, I would like to explore payment plan options</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" name="interested_payment_plan" value="no" id="plan-no">
                        <label for="plan-no">No, I will pay in full</label>
                    </div>
                </div>
            </div>

            <div id="paymentPlanOptions" style="display: none;">
                <h3 class="subsection-title">Select a Payment Plan</h3>

                <div class="payment-plan-option" data-plan="3month">
                    <input type="radio" name="payment_plan_selected" value="3month" id="plan-3month" style="margin-right: 8px;">
                    <label for="plan-3month" style="cursor: pointer; display: inline;">
                        <div class="plan-header">
                            <span class="plan-name">3-Month Payment Plan</span>
                            <span class="plan-amount">Divided over 3 months</span>
                        </div>
                        <p class="plan-description">0% interest, split your balance into 3 equal monthly payments</p>
                    </label>
                </div>

                <div class="payment-plan-option" data-plan="6month">
                    <input type="radio" name="payment_plan_selected" value="6month" id="plan-6month" style="margin-right: 8px;">
                    <label for="plan-6month" style="cursor: pointer; display: inline;">
                        <div class="plan-header">
                            <span class="plan-name">6-Month Payment Plan</span>
                            <span class="plan-amount">Divided over 6 months</span>
                        </div>
                        <p class="plan-description">0% interest, split your balance into 6 equal monthly payments</p>
                    </label>
                </div>

                <div class="payment-plan-option" data-plan="12month">
                    <input type="radio" name="payment_plan_selected" value="12month" id="plan-12month" style="margin-right: 8px;">
                    <label for="plan-12month" style="cursor: pointer; display: inline;">
                        <div class="plan-header">
                            <span class="plan-name">12-Month Payment Plan</span>
                            <span class="plan-amount">Divided over 12 months</span>
                        </div>
                        <p class="plan-description">Low interest, split your balance into 12 monthly payments</p>
                    </label>
                </div>

                <div class="payment-plan-option" data-plan="custom">
                    <input type="radio" name="payment_plan_selected" value="custom" id="plan-custom" style="margin-right: 8px;">
                    <label for="plan-custom" style="cursor: pointer; display: inline;">
                        <div class="plan-header">
                            <span class="plan-name">Custom Payment Plan</span>
                            <span class="plan-amount">Talk to billing specialist</span>
                        </div>
                        <p class="plan-description">Let's work together to create a plan that fits your budget</p>
                    </label>
                </div>

                <div class="form-group" style="margin-top: 18px;">
                    <label class="form-label">Preferred Monthly Payment Amount (Optional)</label>
                    <input type="number" name="preferred_monthly_amount" class="number-input" min="0" step="0.01" placeholder="$0.00">
                    <div class="input-hint">What monthly payment amount works for your budget?</div>
                </div>
            </div>

            <h3 class="subsection-title">Financial Assistance</h3>

            <div class="form-group">
                <label class="form-label">Would you like to apply for financial assistance?</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" name="financial_assistance" value="yes" id="assistance-yes">
                        <label for="assistance-yes">Yes, I would like to apply</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" name="financial_assistance" value="no" id="assistance-no">
                        <label for="assistance-no">No, not at this time</label>
                    </div>
                </div>
            </div>

            <div id="financialAssistanceDetails" style="display: none;">
                <div class="info-box">
                    <p>Our financial assistance program may be able to reduce or eliminate your medical bills based on income and family size. A financial counselor will contact you to discuss your eligibility.</p>
                </div>

                <div class="form-group">
                    <label class="form-label">Reason for Financial Assistance Request</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" name="assistance_reason_income" value="yes" id="reason-income">
                            <label for="reason-income">Low Income</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="assistance_reason_unemployment" value="yes" id="reason-unemployment">
                            <label for="reason-unemployment">Unemployment</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="assistance_reason_medical" value="yes" id="reason-medical">
                            <label for="reason-medical">High Medical Expenses</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="assistance_reason_hardship" value="yes" id="reason-hardship">
                            <label for="reason-hardship">Financial Hardship</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="assistance_reason_other" value="yes" id="reason-other">
                            <label for="reason-other">Other</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Additional Information (Optional)</label>
                    <textarea name="assistance_additional_info" class="textarea-input" rows="4" placeholder="Please provide any additional information about your financial situation that might help us assist you..."></textarea>
                </div>
            </div>

            <h3 class="subsection-title">Charity Care Programs</h3>

            <div class="form-group">
                <label class="form-label">Do you participate in any of the following programs?</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" name="program_medicaid" value="yes" id="prog-medicaid">
                        <label for="prog-medicaid">Medicaid</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" name="program_snap" value="yes" id="prog-snap">
                        <label for="prog-snap">SNAP (Food Stamps)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" name="program_wic" value="yes" id="prog-wic">
                        <label for="prog-wic">WIC</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" name="program_tanf" value="yes" id="prog-tanf">
                        <label for="prog-tanf">TANF</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" name="program_ssi" value="yes" id="prog-ssi">
                        <label for="prog-ssi">SSI/Disability</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" name="program_unemployment" value="yes" id="prog-unemployment">
                        <label for="prog-unemployment">Unemployment Benefits</label>
                    </div>
                </div>
                <div class="input-hint">Participation in these programs may qualify you for additional discounts</div>
            </div>
        </div>

        <!-- Section 6: Additional Billing Information -->
        <div class="billing-section">
            <div class="section-header">
                <div class="section-number">6</div>
                <h2 class="section-title">Additional Billing Information</h2>
            </div>

            <div class="form-group">
                <label class="form-label">Do you have an outstanding balance from previous visits?</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" name="has_outstanding_balance" value="yes" id="balance-yes">
                        <label for="balance-yes">Yes</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" name="has_outstanding_balance" value="no" id="balance-no">
                        <label for="balance-no">No</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" name="has_outstanding_balance" value="unknown" id="balance-unknown">
                        <label for="balance-unknown">I'm not sure</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Preferred Contact Time for Billing Questions</label>
                <select name="contact_time_preference" class="select-input">
                    <option value="morning">Morning (8am - 12pm)</option>
                    <option value="afternoon">Afternoon (12pm - 5pm)</option>
                    <option value="evening">Evening (5pm - 8pm)</option>
                    <option value="any">Any time</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Special Billing Instructions or Notes</label>
                <textarea name="billing_notes" class="textarea-input" rows="4" placeholder="Include any special instructions, concerns, or questions about billing..."></textarea>
            </div>

            <h3 class="subsection-title">Authorizations & Agreements</h3>

            <div class="form-group">
                <div class="checkbox-item">
                    <input type="checkbox" name="authorize_payment" value="yes" id="auth-payment" required>
                    <label for="auth-payment">I authorize payment from the payment method provided above <span class="required-mark">*</span></label>
                </div>
            </div>

            <div class="form-group">
                <div class="checkbox-item">
                    <input type="checkbox" name="acknowledge_responsibility" value="yes" id="ack-responsibility" required>
                    <label for="ack-responsibility">I understand that I am financially responsible for all charges not covered by my insurance <span class="required-mark">*</span></label>
                </div>
            </div>

            <div class="form-group">
                <div class="checkbox-item">
                    <input type="checkbox" name="agree_payment_policy" value="yes" id="agree-policy" required>
                    <label for="agree-policy">I have read and agree to the payment policies <span class="required-mark">*</span></label>
                </div>
            </div>

            <div class="warning-box">
                <p><strong>Payment Policy:</strong> Payment is due at the time of service unless other arrangements have been made. Copays and deductibles must be paid before services are rendered. For patients without insurance, payment in full is expected at time of service. We accept cash, checks, credit cards, and offer payment plans for qualified patients.</p>
            </div>
        </div>

        <!-- Submit Section -->
        <div class="submit-container">
            <p style="color: #6b7280; margin-bottom: 18px; font-size: 12px; line-height: 1.5;">
                By submitting this form, I certify that the billing information provided is accurate and I authorize charges to the payment method indicated.
            </p>
            <button type="submit" class="submit-button">Submit Billing Information</button>
        </div>
    </form>
</div>

<script>
    // Progress tracking
    function updateProgress() {
        const form = document.getElementById('billingForm');
        const inputs = form.querySelectorAll('input[required], select[required], textarea[required]');
        const filled = Array.from(inputs).filter(input => {
            if (input.type === 'radio') {
                return form.querySelector(`input[name="${input.name}"]:checked`);
            } else if (input.type === 'checkbox') {
                return input.checked;
            } else {
                return input.value.trim() !== '';
            }
        });

        const uniqueRequired = new Set();
        inputs.forEach(input => {
            if (input.type === 'radio' || input.type === 'checkbox') {
                uniqueRequired.add(input.name);
            } else {
                uniqueRequired.add(input);
            }
        });

        const uniqueFilled = new Set();
        filled.forEach(input => {
            if (input.type === 'radio' || input.type === 'checkbox') {
                uniqueFilled.add(input.name);
            } else {
                uniqueFilled.add(input);
            }
        });

        const progress = (uniqueFilled.size / uniqueRequired.size) * 100;
        document.getElementById('progressFill').style.width = progress + '%';
        document.getElementById('progressText').textContent = Math.round(progress) + '% Complete';
    }

    // Payment method selection
    document.querySelectorAll('input[name="payment_method"]').forEach(radio => {
        radio.addEventListener('change', function() {
            document.getElementById('creditCardDetails').style.display = 'none';
            document.getElementById('bankAccountDetails').style.display = 'none';

            if (this.value === 'credit_card') {
                document.getElementById('creditCardDetails').style.display = 'block';
            } else if (this.value === 'bank_account') {
                document.getElementById('bankAccountDetails').style.display = 'block';
            }
            updateProgress();
        });
    });

    // Payment plan interest
    document.querySelectorAll('input[name="interested_payment_plan"]').forEach(radio => {
        radio.addEventListener('change', function() {
            const options = document.getElementById('paymentPlanOptions');
            options.style.display = this.value === 'yes' ? 'block' : 'none';
            updateProgress();
        });
    });

    // Financial assistance
    document.querySelectorAll('input[name="financial_assistance"]').forEach(radio => {
        radio.addEventListener('change', function() {
            const details = document.getElementById('financialAssistanceDetails');
            details.style.display = this.value === 'yes' ? 'block' : 'none';
            updateProgress();
        });
    });

    // Payment plan option selection styling
    document.querySelectorAll('.payment-plan-option').forEach(option => {
        option.addEventListener('click', function() {
            document.querySelectorAll('.payment-plan-option').forEach(opt => opt.classList.remove('selected'));
            this.classList.add('selected');
            this.querySelector('input[type="radio"]').checked = true;
        });
    });

    // Guarantor same as patient checkbox
    document.getElementById('guarantor-same').addEventListener('change', function() {
        const details = document.getElementById('guarantorDetails');
        if (this.checked) {
            details.style.opacity = '0.5';
            details.style.pointerEvents = 'none';
        } else {
            details.style.opacity = '1';
            details.style.pointerEvents = 'auto';
        }
        updateProgress();
    });

    // Guarantor address same as billing checkbox
    document.getElementById('guarantor-address-same').addEventListener('change', function() {
        const fields = document.getElementById('guarantorAddressFields');
        if (this.checked) {
            fields.style.opacity = '0.5';
            fields.style.pointerEvents = 'none';
        } else {
            fields.style.opacity = '1';
            fields.style.pointerEvents = 'auto';
        }
        updateProgress();
    });

    // Update progress on any input change
    document.getElementById('billingForm').addEventListener('input', updateProgress);
    document.getElementById('billingForm').addEventListener('change', updateProgress);

    // Initial progress calculation
    updateProgress();

    // Form validation
    document.getElementById('billingForm').addEventListener('submit', function(e) {
        // Validate bank account confirmation if bank payment is selected
        const paymentMethod = document.querySelector('input[name="payment_method"]:checked');
        if (paymentMethod && paymentMethod.value === 'bank_account') {
            const accountNum = document.querySelector('input[name="bank_account_number"]').value;
            const accountConfirm = document.querySelector('input[name="bank_account_number_confirm"]').value;
            if (accountNum !== accountConfirm) {
                e.preventDefault();
                alert('Bank account numbers do not match. Please verify and try again.');
                return false;
            }
        }
    });
</script>
{% endblock %}
