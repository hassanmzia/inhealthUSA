{% extends 'healthcare/base.html' %}

{% block title %}Alerts & Notifications - InHealth EHR{% endblock %}

{% block content %}
<div class="breadcrumbs">
    <a href="{% url 'index' %}">Home</a> &rsaquo;
    <a href="{% url 'patient_dashboard' %}">My Dashboard</a> &rsaquo;
    Alerts & Notifications
</div>

<div class="module">
    <h1>üîî Alerts & Notifications</h1>
    <p style="color: #666; margin-top: 10px;">{{ patient.full_name }}</p>

    <div style="display: flex; gap: 15px; margin: 20px 0;">
        <a href="{% url 'patient_inbox' %}" class="button" style="padding: 10px 20px; background: #2196F3; color: white; text-decoration: none; border-radius: 5px;">
            Back to Inbox
        </a>
        <a href="{% url 'patient_compose_message' %}" class="button" style="padding: 10px 20px; background: #4caf50; color: white; text-decoration: none; border-radius: 5px;">
            Message My Doctor
        </a>
    </div>

    <!-- Notifications Section -->
    <div class="module" style="margin-top: 30px;">
        <h2>All Alerts & Notifications ({{ unread_count }} unread)</h2>

        {% if notifications_list %}
        <form method="POST">
            {% csrf_token %}
            <div style="margin-bottom: 15px;">
                <button type="submit" style="padding: 8px 20px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    Mark Selected as Read
                </button>
            </div>

            <table style="width: 100%; margin-top: 10px;">
                <thead>
                    <tr>
                        <th style="text-align: left; padding: 10px; background: #f0f0f0; width: 50px;">
                            <input type="checkbox" id="select-all">
                        </th>
                        <th style="text-align: left; padding: 10px; background: #f0f0f0; width: 80px;">Status</th>
                        <th style="text-align: left; padding: 10px; background: #f0f0f0; width: 100px;">Type</th>
                        <th style="text-align: left; padding: 10px; background: #f0f0f0;">Alert Details</th>
                        <th style="text-align: left; padding: 10px; background: #f0f0f0; width: 150px;">Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for notification in notifications_list %}
                    <tr style="border-bottom: 1px solid #e8e8e8; {% if not notification.is_read %}background: #fff5f5;{% endif %}">
                        <td style="padding: 10px; text-align: center;">
                            {% if not notification.is_read %}
                            <input type="checkbox" name="mark_read" value="{{ notification.notification_id }}" class="notification-checkbox">
                            {% endif %}
                        </td>
                        <td style="padding: 10px; text-align: center;">
                            {% if not notification.is_read %}
                            <span style="display: inline-block; padding: 3px 10px; background: #f44336; color: white; border-radius: 3px; font-size: 12px;">Unread</span>
                            {% else %}
                            <span style="display: inline-block; padding: 3px 10px; background: #ccc; color: white; border-radius: 3px; font-size: 12px;">Read</span>
                            {% endif %}
                        </td>
                        <td style="padding: 10px;">
                            <span style="padding: 3px 8px; border-radius: 3px; background:
                                {% if notification.notification_type == 'appointment' %}#e7f3ff
                                {% elif notification.notification_type == 'lab_result' %}#f3e7ff
                                {% elif notification.notification_type == 'prescription' %}#fff3e7
                                {% elif notification.notification_type == 'message' %}#e7ffe7
                                {% else %}#f0f0f0{% endif %}; font-size: 12px;">
                                {{ notification.get_notification_type_display }}
                            </span>
                        </td>
                        <td style="padding: 10px;">
                            <strong {% if not notification.is_read %}style="font-weight: bold;"{% endif %}>
                                {{ notification.title }}
                            </strong><br>
                            <div style="color: #666; margin-top: 5px;">{{ notification.message }}</div>
                            {% if notification.is_read and notification.read_at %}
                            <small style="color: #999;">Read on {{ notification.read_at|date:"M d, Y H:i" }}</small>
                            {% endif %}
                        </td>
                        <td style="padding: 10px;">
                            {{ notification.created_at|date:"M d, Y" }}<br>
                            <small style="color: #666;">{{ notification.created_at|date:"H:i" }}</small>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </form>

        <script>
            // Select all checkbox functionality
            document.getElementById('select-all').addEventListener('change', function() {
                var checkboxes = document.querySelectorAll('.notification-checkbox');
                checkboxes.forEach(function(checkbox) {
                    checkbox.checked = document.getElementById('select-all').checked;
                });
            });
        </script>

        {% else %}
        <p style="padding: 20px; text-align: center; color: #999;">No notifications yet</p>
        {% endif %}
    </div>

    <!-- Alert Types Legend -->
    <div class="module" style="margin-top: 30px;">
        <h3>Alert Types</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
            <div style="padding: 15px; background: #e7f3ff; border-left: 3px solid #2196F3; border-radius: 5px;">
                <strong>üìÖ Appointment</strong><br>
                <small>Appointment reminders, confirmations, or changes from your doctor or office staff</small>
            </div>
            <div style="padding: 15px; background: #f3e7ff; border-left: 3px solid #9c27b0; border-radius: 5px;">
                <strong>üî¨ Lab Result</strong><br>
                <small>New lab test results available for your review</small>
            </div>
            <div style="padding: 15px; background: #fff3e7; border-left: 3px solid #ff9800; border-radius: 5px;">
                <strong>üíä Prescription</strong><br>
                <small>New prescriptions, refills, or medication updates from your doctor</small>
            </div>
            <div style="padding: 15px; background: #e7ffe7; border-left: 3px solid #4caf50; border-radius: 5px;">
                <strong>‚úâÔ∏è Message</strong><br>
                <small>New messages from your doctor, nurse, or healthcare team</small>
            </div>
            <div style="padding: 15px; background: #ffe7e7; border-left: 3px solid #f44336; border-radius: 5px;">
                <strong>‚öôÔ∏è System</strong><br>
                <small>Important system alerts, reminders, and administrative notifications</small>
            </div>
        </div>
    </div>
</div>
{% endblock %}
