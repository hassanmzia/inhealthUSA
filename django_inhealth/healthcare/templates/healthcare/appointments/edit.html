{% extends 'healthcare/base.html' %}
{% block title %}Edit Appointment - InHealth EHR{% endblock %}
{% block breadcrumbs %}&rsaquo; <a href="{% url 'appointment_list' %}">Appointments</a> &rsaquo; <a href="{% url 'appointment_detail' appointment.encounter_id %}">{{ appointment.patient.full_name }}</a> &rsaquo; Edit{% endblock %}
{% block content %}<style>.appointment-header{background:white;border:1px solid var(--hairline-color);border-radius:4px;padding:20px;margin-bottom:20px;display:flex;justify-content:space-between;align-items:center}.appointment-header h1{margin:0 0 8px 0;font-size:28px;font-weight:300}.appointment-header .meta{font-size:13px;color:#666}.appointment-tabs{background:white;border:1px solid var(--hairline-color);border-radius:4px;margin-bottom:20px;overflow:hidden}.tab-navigation{background:var(--darkened-bg);border-bottom:2px solid var(--primary);display:flex}.tab-button{flex:0 0 auto;padding:12px 24px;border:none;background:transparent;color:var(--body-fg);cursor:pointer;font-size:13px;font-weight:500;white-space:nowrap;position:relative;transition:all 0.2s}.tab-button:hover{background:rgba(65,118,144,0.1)}.tab-button.active{background:white;color:var(--primary);font-weight:600}.tab-button.active::after{content:'';position:absolute;bottom:-2px;left:0;right:0;height:2px;background:var(--primary)}.tab-content{display:none;padding:20px}.tab-content.active{display:block}.form-section{background:white;border:1px solid var(--hairline-color);border-radius:4px;padding:20px}.form-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-bottom:20px}.form-row.full-width{grid-template-columns:1fr}.form-field{margin-bottom:0}.form-field label{display:block;margin-bottom:6px;font-weight:500;font-size:13px;color:var(--body-fg)}.form-field label.required::after{content:' *';color:var(--error-fg)}.form-field input[type="text"],.form-field input[type="date"],.form-field input[type="datetime-local"],.form-field select,.form-field textarea{width:100%;padding:8px 10px;border:1px solid var(--border-color);border-radius:4px;font-size:14px;transition:border-color 0.2s}.form-field input:focus,.form-field select:focus,.form-field textarea:focus{border-color:var(--primary);outline:none;box-shadow:0 0 0 3px rgba(65,118,144,0.1)}.data-table-container{background:white;border:1px solid var(--hairline-color);border-radius:4px;overflow:hidden}.data-table-header{background:var(--primary);color:var(--header-link-color);padding:12px 20px;display:flex;justify-content:space-between;align-items:center}.data-table-header h3{margin:0;font-size:15px;font-weight:500}.data-table-header .add-button{background:rgba(255,255,255,0.2);padding:6px 14px;border-radius:3px;color:white;text-decoration:none;font-size:12px;font-weight:600;transition:background 0.2s}.data-table-header .add-button:hover{background:rgba(255,255,255,0.3)}.data-table{width:100%;border-collapse:collapse}.data-table thead{background:var(--darkened-bg)}.data-table thead th{text-align:left;padding:10px 15px;font-size:11px;font-weight:600;text-transform:uppercase;color:var(--body-fg);border-bottom:1px solid var(--hairline-color)}.data-table tbody td{padding:12px 15px;border-bottom:1px solid var(--hairline-color);font-size:13px}.data-table tbody tr:hover{background:var(--darkened-bg)}.data-table tbody tr:last-child td{border-bottom:none}.badge{display:inline-block;padding:4px 10px;border-radius:12px;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px}.badge-success{background:#d4edda;color:#155724}.badge-warning{background:#fff3cd;color:#856404}.badge-danger{background:#f8d7da;color:#721c24}.badge-secondary{background:#e2e3e5;color:#383d41}.empty-state{text-align:center;padding:40px 20px;color:#999}.empty-state svg{width:64px;height:64px;margin:0 auto 16px;opacity:0.3}.submit-row{background:var(--darkened-bg);padding:15px 20px;margin:-20px -20px -20px -20px;margin-top:20px;border-top:1px solid var(--hairline-color);text-align:right}</style><div class="appointment-header"><div><h1>Edit Appointment</h1><div class="meta"><strong>Patient:</strong> <a href="{% url 'patient_detail' appointment.patient.patient_id %}" style="color:var(--link-fg)">{{ appointment.patient.full_name }}</a> | <strong>Encounter ID:</strong> {{ appointment.encounter_id }}</div></div><div><a href="{% url 'appointment_detail' appointment.encounter_id %}" class="button button-secondary">View Details</a></div></div><div class="appointment-tabs"><div class="tab-navigation"><button class="tab-button active" onclick="showTab('details')">Appointment Details</button><button class="tab-button" onclick="showTab('vitals')">Vital Signs</button><button class="tab-button" onclick="showTab('diagnoses')">Diagnoses</button><button class="tab-button" onclick="showTab('prescriptions')">Prescriptions</button></div><div id="tab-details" class="tab-content active"><form method="POST" class="form-section">{% csrf_token %}<h2 style="margin-top:0;margin-bottom:20px;font-size:16px;color:var(--primary);">Appointment Information</h2><div class="form-row"><div class="form-field"><label class="required">Provider</label><select name="provider_id" required>{% for physician in physicians %}<option value="{{ physician.provider_id }}" {% if appointment.provider_id == physician.provider_id %}selected{% endif %}>Dr. {{ physician.full_name }}</option>{% endfor %}</select></div><div class="form-field"><label>Department</label><select name="department_id"><option value="">No Department</option>{% for department in departments %}<option value="{{ department.department_id }}" {% if appointment.department_id == department.department_id %}selected{% endif %}>{{ department.department_name }}</option>{% endfor %}</select></div></div><div class="form-row"><div class="form-field"><label class="required">Date & Time</label><input type="datetime-local" name="encounter_date" value="{{ appointment.encounter_date|date:'Y-m-d\TH:i' }}" required></div><div class="form-field"><label class="required">Type</label><select name="encounter_type" required><option value="Office Visit" {% if appointment.encounter_type == 'Office Visit' %}selected{% endif %}>Office Visit</option><option value="Follow-up" {% if appointment.encounter_type == 'Follow-up' %}selected{% endif %}>Follow-up</option><option value="Annual Physical" {% if appointment.encounter_type == 'Annual Physical' %}selected{% endif %}>Annual Physical</option><option value="Urgent Care" {% if appointment.encounter_type == 'Urgent Care' %}selected{% endif %}>Urgent Care</option><option value="Consultation" {% if appointment.encounter_type == 'Consultation' %}selected{% endif %}>Consultation</option><option value="Telemedicine" {% if appointment.encounter_type == 'Telemedicine' %}selected{% endif %}>Telemedicine</option><option value="Emergency" {% if appointment.encounter_type == 'Emergency' %}selected{% endif %}>Emergency</option><option value="Procedure" {% if appointment.encounter_type == 'Procedure' %}selected{% endif %}>Procedure</option><option value="Lab Review" {% if appointment.encounter_type == 'Lab Review' %}selected{% endif %}>Lab Review</option></select></div><div class="form-field"><label class="required">Status</label><select name="status" required><option value="Scheduled" {% if appointment.status == 'Scheduled' %}selected{% endif %}>Scheduled</option><option value="Checked In" {% if appointment.status == 'Checked In' %}selected{% endif %}>Checked In</option><option value="In Progress" {% if appointment.status == 'In Progress' %}selected{% endif %}>In Progress</option><option value="Completed" {% if appointment.status == 'Completed' %}selected{% endif %}>Completed</option><option value="Cancelled" {% if appointment.status == 'Cancelled' %}selected{% endif %}>Cancelled</option><option value="No Show" {% if appointment.status == 'No Show' %}selected{% endif %}>No Show</option></select></div></div><div class="form-row full-width"><div class="form-field"><label>Chief Complaint</label><textarea name="chief_complaint" rows="2">{{ appointment.chief_complaint|default:'' }}</textarea></div></div><div class="form-row full-width"><div class="form-field"><label>Clinical Impression</label><textarea name="clinical_impression" rows="3">{{ appointment.clinical_impression|default:'' }}</textarea></div></div><div class="form-row full-width"><div class="form-field"><label>Treatment Plan</label><textarea name="treatment_plan" rows="3">{{ appointment.treatment_plan|default:'' }}</textarea></div></div><div class="form-row full-width"><div class="form-field"><label>Notes</label><textarea name="notes" rows="3">{{ appointment.notes|default:'' }}</textarea></div></div><div class="submit-row"><button type="submit" class="button">Save Appointment</button></div></form></div><div id="tab-vitals" class="tab-content"><div class="data-table-container"><div class="data-table-header"><h3>Vital Signs Records</h3><a href="{% url 'encounter_vital_create' appointment.encounter_id %}" class="add-button">+ Add Vital Signs</a></div>{% if vital_signs %}<table class="data-table"><thead><tr><th>Date & Time</th><th>Blood Pressure</th><th>Heart Rate</th><th>Temperature</th><th>Weight</th><th>Actions</th></tr></thead><tbody>{% for vital in vital_signs %}<tr><td>{{ vital.recorded_at|date:"M d, Y H:i" }}</td><td>{{ vital.blood_pressure|default:"—" }}</td><td>{% if vital.heart_rate %}{{ vital.heart_rate }} bpm{% else %}—{% endif %}</td><td>{% if vital.temperature_value %}{{ vital.temperature_value }}°{{ vital.temperature_unit }}{% else %}—{% endif %}</td><td>{% if vital.weight_value %}{{ vital.weight_value }} {{ vital.weight_unit }}{% else %}—{% endif %}</td><td><a href="{% url 'encounter_vital_edit' appointment.encounter_id vital.vital_signs_id %}" style="color:var(--link-fg);font-weight:500">Edit</a></td></tr>{% endfor %}</tbody></table>{% else %}<div class="empty-state"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg><p>No vital signs recorded yet</p></div>{% endif %}</div></div><div id="tab-diagnoses" class="tab-content"><div class="data-table-container"><div class="data-table-header"><h3>Diagnosis Records</h3><a href="{% url 'encounter_diagnosis_create' appointment.encounter_id %}" class="add-button">+ Add Diagnosis</a></div>{% if diagnoses %}<table class="data-table"><thead><tr><th>Date</th><th>Description</th><th>ICD-10</th><th>Type</th><th>Status</th><th>Actions</th></tr></thead><tbody>{% for diagnosis in diagnoses %}<tr><td>{{ diagnosis.diagnosed_at|date:"M d, Y" }}</td><td>{{ diagnosis.diagnosis_description }}</td><td>{{ diagnosis.icd10_code|default:"—" }}</td><td>{{ diagnosis.diagnosis_type }}</td><td><span class="badge {% if diagnosis.status == 'Active' %}badge-success{% elif diagnosis.status == 'Resolved' %}badge-secondary{% else %}badge-warning{% endif %}">{{ diagnosis.status }}</span></td><td><a href="{% url 'encounter_diagnosis_edit' appointment.encounter_id diagnosis.diagnosis_id %}" style="color:var(--link-fg);font-weight:500">Edit</a></td></tr>{% endfor %}</tbody></table>{% else %}<div class="empty-state"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><p>No diagnoses recorded yet</p></div>{% endif %}</div></div><div id="tab-prescriptions" class="tab-content"><div class="data-table-container"><div class="data-table-header"><h3>Prescription Records</h3><a href="{% url 'encounter_prescription_create' appointment.encounter_id %}" class="add-button">+ Add Prescription</a></div>{% if prescriptions %}<table class="data-table"><thead><tr><th>Medication</th><th>Dosage</th><th>Frequency</th><th>Start Date</th><th>Status</th><th>Actions</th></tr></thead><tbody>{% for prescription in prescriptions %}<tr><td><strong>{{ prescription.medication_name }}</strong></td><td>{{ prescription.dosage }}</td><td>{{ prescription.frequency }}</td><td>{{ prescription.start_date|date:"M d, Y" }}</td><td><span class="badge {% if prescription.status == 'Active' %}badge-success{% elif prescription.status == 'Discontinued' %}badge-danger{% else %}badge-secondary{% endif %}">{{ prescription.status }}</span></td><td><a href="{% url 'encounter_prescription_edit' appointment.encounter_id prescription.prescription_id %}" style="color:var(--link-fg);font-weight:500">Edit</a></td></tr>{% endfor %}</tbody></table>{% else %}<div class="empty-state"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><p>No prescriptions recorded yet</p></div>{% endif %}</div></div></div><script>function showTab(tabName){document.querySelectorAll('.tab-content').forEach(content=>{content.classList.remove('active')});document.querySelectorAll('.tab-button').forEach(button=>{button.classList.remove('active')});document.getElementById('tab-'+tabName).classList.add('active');const buttons=document.querySelectorAll('.tab-button');buttons.forEach(button=>{if(button.textContent.toLowerCase().replace(/\s+/g,'-').includes(tabName.toLowerCase())){button.classList.add('active')}})}</script>{% endblock %}
