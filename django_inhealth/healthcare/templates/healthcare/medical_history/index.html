{% extends 'healthcare/base.html' %}
{% block title %}Medical History - InHealth EHR{% endblock %}
{% block breadcrumbs %}&rsaquo; Medical History{% endblock %}
{% block content %}
<style>
    .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .page-header h1 { margin: 0; font-size: 28px; font-weight: 300; }
    .filter-form { background: white; padding: 15px; margin-bottom: 20px; border: 1px solid var(--hairline-color); border-radius: 4px; }
    .filter-form form { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    .filter-form label { font-size: 13px; font-weight: 600; color: var(--body-fg); }
    .filter-form select, .filter-form input[type="text"] { padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 14px; }
    .filter-form input[type="text"] { flex: 1; min-width: 250px; }
    .data-module { background: white; border: 1px solid var(--hairline-color); border-radius: 4px; overflow: hidden; }
    .data-module table { width: 100%; border-collapse: collapse; }
    .data-module caption { background: var(--primary); color: var(--header-link-color); padding: 12px 15px; text-align: left; font-weight: 500; font-size: 15px; }
    .data-module thead { background: var(--darkened-bg); }
    .data-module thead th { padding: 10px 15px; text-align: left; font-size: 11px; font-weight: 600; text-transform: uppercase; color: var(--body-fg); border-bottom: 1px solid var(--hairline-color); }
    .data-module tbody td { padding: 12px 15px; border-bottom: 1px solid var(--hairline-color); font-size: 13px; }
    .data-module tbody tr:hover { background: var(--darkened-bg); }
    .condition-name { font-weight: 600; color: var(--body-fg); }
    .patient-link { color: var(--link-fg); font-weight: 500; }
    .status-badge { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
    .status-badge.status-active { background: #d4edda; color: #155724; }
    .status-badge.status-resolved { background: #e2e3e5; color: #383d41; }
    .status-badge.status-chronic { background: #fff3cd; color: #856404; }
    .empty-state { text-align: center; padding: 60px 20px; color: #999; }
    .empty-state svg { width: 80px; height: 80px; margin: 0 auto 20px; opacity: 0.3; }
    .stats-bar { background: white; border: 1px solid var(--hairline-color); border-radius: 4px; padding: 15px 20px; margin-bottom: 20px; display: flex; justify-content: space-around; align-items: center; }
    .stat-item { text-align: center; }
    .stat-value { font-size: 24px; font-weight: 600; color: var(--primary); }
    .stat-label { font-size: 12px; color: #666; text-transform: uppercase; letter-spacing: 0.5px; }
</style>

<div class="page-header">
    <h1>Medical History</h1>
    <div><a href="/admin/healthcare/medicalhistory/add/" class="button">+ New Record</a></div>
</div>

<div class="stats-bar">
    <div class="stat-item"><div class="stat-value">{{ medical_histories|length }}</div><div class="stat-label">Total Records</div></div>
    <div class="stat-item"><div class="stat-value">{{ active_count|default:0 }}</div><div class="stat-label">Active Conditions</div></div>
</div>

<div class="filter-form">
    <form method="get">
        <input type="text" name="search" value="{{ search }}" placeholder="Search by condition or patient name...">
        <label for="status">Status:</label>
        <select name="status" id="status">
            <option value="">All Statuses</option>
            <option value="Active" {% if status == 'Active' %}selected{% endif %}>Active</option>
            <option value="Resolved" {% if status == 'Resolved' %}selected{% endif %}>Resolved</option>
            <option value="Chronic" {% if status == 'Chronic' %}selected{% endif %}>Chronic</option>
        </select>
        <button type="submit" class="button">Filter</button>
        {% if search or status %}<a href="{% url 'medical_history_list' %}" class="button button-secondary">Clear</a>{% endif %}
    </form>
</div>

<div class="data-module">
    <table>
        <caption>{% if search %}Search Results for "{{ search }}"{% elif status %}{{ status }} Conditions{% else %}All Medical History{% endif %}</caption>
        <thead>
            <tr><th>History ID</th><th>Condition</th><th>Patient</th><th>Diagnosis Date</th><th>Status</th><th>Actions</th></tr>
        </thead>
        <tbody>
            {% for history in medical_histories %}
            <tr>
                <td><strong>{{ history.medical_history_id }}</strong></td>
                <td class="condition-name">{{ history.condition }}</td>
                <td><a href="{% url 'patient_detail' history.patient.patient_id %}" class="patient-link">{{ history.patient.full_name }}</a></td>
                <td>{{ history.diagnosis_date|date:"M d, Y"|default:"â€”" }}</td>
                <td><span class="status-badge status-{{ history.status|lower }}">{{ history.status }}</span></td>
                <td><a href="{% url 'medical_history_detail' history.medical_history_id %}" style="color: var(--link-fg); font-weight: 500;">View</a></td>
            </tr>
            {% empty %}
            <tr><td colspan="6"><div class="empty-state"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><p>{% if search %}No records found matching "{{ search }}"{% else %}No medical history recorded yet{% endif %}</p></div></td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<p style="margin-top: 20px; font-size: 12px; color: #666;"><strong>Tip:</strong> Use the <a href="/admin/healthcare/medicalhistory/">Django Admin Panel</a> for advanced management operations.</p>
{% endblock %}
