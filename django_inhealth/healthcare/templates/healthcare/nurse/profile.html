{% extends 'healthcare/base.html' %}

{% block title %}Nurse Profile - InHealth EHR{% endblock %}

{% block content %}
<style>
.profile-picture-section{display:flex;flex-direction:column;align-items:center;gap:10px;margin-bottom:20px}
.profile-picture{width:120px;height:120px;border-radius:50%;object-fit:cover;border:3px solid #417690;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
.profile-picture-placeholder{width:120px;height:120px;border-radius:50%;background:#f0f0f0;display:flex;align-items:center;justify-content:center;font-size:48px;color:#999;border:3px solid #ddd}
.profile-picture-actions{display:flex;gap:5px;flex-wrap:wrap;justify-content:center}
.profile-picture-btn{padding:6px 12px;font-size:11px;background:#417690;color:white;border:none;border-radius:3px;cursor:pointer;text-decoration:none;display:inline-block}
.profile-picture-btn:hover{background:#2c5364}
.profile-picture-btn.delete{background:#dc3545}
.profile-picture-btn.delete:hover{background:#c82333}
</style>

<div class="breadcrumbs">
    <a href="{% url 'index' %}">Home</a> &rsaquo;
    <a href="{% url 'nurse_dashboard' %}">Nurse Dashboard</a> &rsaquo;
    My Profile
</div>

<div class="module">
    <h1>Nurse Profile</h1>

    <!-- Profile Information -->
    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 30px; margin: 20px 0;">
        <div class="module">
            <h2>Personal Information</h2>
            <div style="padding: 20px;">
                <!-- Profile Picture Section -->
                <div class="profile-picture-section">
                    {% if user.profile.profile_picture %}
                        <img src="{{ user.profile.profile_picture.url }}" alt="Profile Picture" class="profile-picture">
                    {% else %}
                        <div class="profile-picture-placeholder">üë§</div>
                    {% endif %}
                    <div class="profile-picture-actions">
                        <form method="post" action="{% url 'upload_profile_picture' %}" enctype="multipart/form-data" style="display:inline;">
                            {% csrf_token %}
                            <label for="id_profile_picture_nurse" class="profile-picture-btn" style="margin:0;cursor:pointer;">
                                {% if user.profile.profile_picture %}Change{% else %}Upload{% endif %}
                            </label>
                            <input type="file" id="id_profile_picture_nurse" name="profile_picture" accept="image/*" style="display:none;" onchange="this.form.submit()">
                        </form>
                        {% if user.profile.profile_picture %}
                        <form method="post" action="{% url 'delete_profile_picture' %}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete your profile picture?');">
                            {% csrf_token %}
                            <button type="submit" class="profile-picture-btn delete">Remove</button>
                        </form>
                        {% endif %}
                    </div>
                </div>

                <div style="margin-bottom: 15px;">
                    <strong>Name:</strong><br>
                    {{ user.first_name }} {{ user.last_name }}
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>Username:</strong><br>
                    {{ user.username }}
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>Email:</strong><br>
                    {{ user.email|default:"Not provided" }}
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>Phone:</strong><br>
                    {{ nurse_profile.phone|default:"Not provided" }}
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>Date of Birth:</strong><br>
                    {{ nurse_profile.date_of_birth|date:"M d, Y"|default:"Not provided" }}
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>Role:</strong><br>
                    Nurse
                </div>
                <div style="margin-top: 20px; display: flex; gap: 10px; flex-direction: column;">
                    <a href="{% url 'nurse_profile_edit' %}" class="button" style="display: inline-block; padding: 10px 20px; background: #417690; color: white; text-decoration: none; border-radius: 3px; text-align: center;">
                        Edit Profile
                    </a>
                    <a href="{% url 'change_password' %}" class="button" style="display: inline-block; padding: 10px 20px; background: #6c757d; color: white; text-decoration: none; border-radius: 3px; text-align: center;">
                        üîë Change Password
                    </a>
                </div>
            </div>
        </div>

        <div>
            <!-- Today's Statistics -->
            <div class="module">
                <h2>Today's Activity</h2>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; padding: 20px;">
                    <div style="text-align: center; padding: 15px; background: #e7f3ff; border-radius: 5px;">
                        <div style="font-size: 32px; font-weight: bold; color: #417690;">{{ stats.patients_seen_today }}</div>
                        <div style="font-size: 12px; color: #666;">Patients Seen</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #e7ffe7; border-radius: 5px;">
                        <div style="font-size: 32px; font-weight: bold; color: #4caf50;">{{ stats.vitals_recorded_today }}</div>
                        <div style="font-size: 12px; color: #666;">Vitals Recorded</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #ffe7f3; border-radius: 5px;">
                        <div style="font-size: 32px; font-weight: bold; color: #e91e63;">{{ stats.appointments_today }}</div>
                        <div style="font-size: 12px; color: #666;">Appointments</div>
                    </div>
                </div>
            </div>

            <!-- Recent Vitals Recorded -->
            <div class="module" style="margin-top: 20px;">
                <h2>Recent Vital Signs Activity</h2>
                <table style="width: 100%; margin-top: 10px;">
                    <thead>
                        <tr>
                            <th style="text-align: left; padding: 10px; background: #f0f0f0;">Patient</th>
                            <th style="text-align: left; padding: 10px; background: #f0f0f0;">BP</th>
                            <th style="text-align: left; padding: 10px; background: #f0f0f0;">HR</th>
                            <th style="text-align: left; padding: 10px; background: #f0f0f0;">Temp</th>
                            <th style="text-align: left; padding: 10px; background: #f0f0f0;">Time</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for vital in recent_vitals %}
                        <tr style="border-bottom: 1px solid #e8e8e8;">
                            <td style="padding: 10px;">
                                <a href="{% url 'patient_detail' vital.encounter.patient.patient_id %}">{{ vital.encounter.patient.full_name }}</a>
                            </td>
                            <td style="padding: 10px;">
                                {% if vital.blood_pressure_systolic and vital.blood_pressure_diastolic %}
                                    {{ vital.blood_pressure_systolic }}/{{ vital.blood_pressure_diastolic }}
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td style="padding: 10px;">{{ vital.heart_rate|default:"-" }}</td>
                            <td style="padding: 10px;">
                                {% if vital.temperature_value %}
                                    {{ vital.temperature_value }}¬∞{{ vital.temperature_unit|default:"F" }}
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td style="padding: 10px;">{{ vital.recorded_at|date:"M d, H:i" }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" style="padding: 10px; text-align: center; color: #999;">No recent vitals</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <div style="margin-top: 10px; padding: 10px;">
                    <a href="{% url 'nurse_vitals_list' %}">View All Vitals &raquo;</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Links -->
    <div class="module" style="margin-top: 20px;">
        <h2>Quick Links</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; padding: 20px;">
            <a href="{% url 'nurse_dashboard' %}" style="display: block; padding: 15px; text-align: center; background: white; border: 1px solid #e8e8e8; border-radius: 5px; text-decoration: none;">
                <div style="font-size: 24px; margin-bottom: 5px;">üìä</div>
                <div>Dashboard</div>
            </a>
            <a href="{% url 'nurse_patients_list' %}" style="display: block; padding: 15px; text-align: center; background: white; border: 1px solid #e8e8e8; border-radius: 5px; text-decoration: none;">
                <div style="font-size: 24px; margin-bottom: 5px;">üë•</div>
                <div>Patients</div>
            </a>
            <a href="{% url 'nurse_vitals_list' %}" style="display: block; padding: 15px; text-align: center; background: white; border: 1px solid #e8e8e8; border-radius: 5px; text-decoration: none;">
                <div style="font-size: 24px; margin-bottom: 5px;">‚ù§Ô∏è</div>
                <div>Vital Signs</div>
            </a>
            <a href="{% url 'appointment_list' %}" style="display: block; padding: 15px; text-align: center; background: white; border: 1px solid #e8e8e8; border-radius: 5px; text-decoration: none;">
                <div style="font-size: 24px; margin-bottom: 5px;">üìÖ</div>
                <div>Appointments</div>
            </a>
        </div>
    </div>
</div>
{% endblock %}
