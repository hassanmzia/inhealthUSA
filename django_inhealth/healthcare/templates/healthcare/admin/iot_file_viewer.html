{% extends 'healthcare/base.html' %}

{% block title %}{{ filename }} - IoT File Viewer{% endblock %}

{% block content %}
<div class="breadcrumbs">
    <a href="{% url 'index' %}">Home</a> &rsaquo;
    <a href="{% url 'admin_dashboard' %}">Admin Dashboard</a> &rsaquo;
    <a href="{% url 'iot_file_manager' %}">IoT File Manager</a> &rsaquo;
    {% if location == 'inbox' %}
    <a href="{% url 'iot_file_manager' %}">Inbox</a> &rsaquo;
    {% else %}
    <a href="{% url 'iot_archive_date' location %}">Archive {{ location }}</a> &rsaquo;
    {% endif %}
    {{ filename }}
</div>

<div class="module">
    <h1>{{ filename }}</h1>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
        <div style="padding: 10px; background: #f0f0f0; border-radius: 3px;">
            <strong>Location:</strong> {{ location|title }}
        </div>
        <div style="padding: 10px; background: #f0f0f0; border-radius: 3px;">
            <strong>Size:</strong> {{ file_size|filesizeformat }}
        </div>
        <div style="padding: 10px; background: #f0f0f0; border-radius: 3px;">
            <strong>Modified:</strong> {{ modified|date:"M d, Y H:i:s" }}
        </div>
    </div>

    <div style="margin: 20px 0;">
        {% if location == 'inbox' %}
        <a href="{% url 'iot_file_manager' %}" class="button" style="background: #417690; color: white; padding: 10px 20px; text-decoration: none; border-radius: 3px; margin-right: 10px;">
            &larr; Back to Inbox
        </a>
        {% else %}
        <a href="{% url 'iot_archive_date' location %}" class="button" style="background: #417690; color: white; padding: 10px 20px; text-decoration: none; border-radius: 3px; margin-right: 10px;">
            &larr; Back to Archive
        </a>
        {% endif %}
        <a href="{% url 'iot_download_file' location filename %}" class="button" style="background: #4caf50; color: white; padding: 10px 20px; text-decoration: none; border-radius: 3px;">
            Download
        </a>
    </div>

    <!-- Parsed Data -->
    <div class="module" style="margin-top: 20px;">
        <h2>Parsed Data</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
            {% if content.device_id %}
            <div style="padding: 15px; background: #e7f3ff; border-radius: 5px; border-left: 4px solid #417690;">
                <strong style="color: #417690;">Device ID:</strong><br>
                <span style="font-family: monospace; font-size: 14px;">{{ content.device_id }}</span>
            </div>
            {% endif %}

            {% if content.timestamp %}
            <div style="padding: 15px; background: #e7ffe7; border-radius: 5px; border-left: 4px solid #4caf50;">
                <strong style="color: #4caf50;">Timestamp:</strong><br>
                <span style="font-size: 14px;">{{ content.timestamp }}</span>
            </div>
            {% endif %}

            {% if content.heart_rate %}
            <div style="padding: 15px; background: #ffe7e7; border-radius: 5px; border-left: 4px solid #f44336;">
                <strong style="color: #f44336;">Heart Rate:</strong><br>
                <span style="font-size: 18px; font-weight: bold;">{{ content.heart_rate }} bpm</span>
            </div>
            {% endif %}

            {% if content.blood_pressure_systolic %}
            <div style="padding: 15px; background: #fff3e7; border-radius: 5px; border-left: 4px solid #ff9800;">
                <strong style="color: #ff9800;">Blood Pressure:</strong><br>
                <span style="font-size: 18px; font-weight: bold;">{{ content.blood_pressure_systolic }}/{{ content.blood_pressure_diastolic }} mmHg</span>
            </div>
            {% endif %}

            {% if content.temperature %}
            <div style="padding: 15px; background: #f3e7ff; border-radius: 5px; border-left: 4px solid #9c27b0;">
                <strong style="color: #9c27b0;">Temperature:</strong><br>
                <span style="font-size: 18px; font-weight: bold;">{{ content.temperature }}Â° {{ content.temperature_unit|default:"F" }}</span>
            </div>
            {% endif %}

            {% if content.oxygen_saturation %}
            <div style="padding: 15px; background: #e7f3ff; border-radius: 5px; border-left: 4px solid #2196F3;">
                <strong style="color: #2196F3;">Oxygen Saturation:</strong><br>
                <span style="font-size: 18px; font-weight: bold;">{{ content.oxygen_saturation }}%</span>
            </div>
            {% endif %}

            {% if content.glucose %}
            <div style="padding: 15px; background: #ffe7f3; border-radius: 5px; border-left: 4px solid #e91e63;">
                <strong style="color: #e91e63;">Glucose:</strong><br>
                <span style="font-size: 18px; font-weight: bold;">{{ content.glucose }} mg/dL</span>
            </div>
            {% endif %}

            {% if content.respiratory_rate %}
            <div style="padding: 15px; background: #e7ffe7; border-radius: 5px; border-left: 4px solid #4caf50;">
                <strong style="color: #4caf50;">Respiratory Rate:</strong><br>
                <span style="font-size: 18px; font-weight: bold;">{{ content.respiratory_rate }}/min</span>
            </div>
            {% endif %}

            {% if content.weight %}
            <div style="padding: 15px; background: #fff3e7; border-radius: 5px; border-left: 4px solid #ff9800;">
                <strong style="color: #ff9800;">Weight:</strong><br>
                <span style="font-size: 18px; font-weight: bold;">{{ content.weight }} {{ content.weight_unit|default:"lbs" }}</span>
            </div>
            {% endif %}

            {% if content.battery_level %}
            <div style="padding: 15px; background: #f9f9f9; border-radius: 5px; border-left: 4px solid #666;">
                <strong style="color: #666;">Battery Level:</strong><br>
                <span style="font-size: 18px; font-weight: bold;">{{ content.battery_level }}%</span>
            </div>
            {% endif %}

            {% if content.signal_quality %}
            <div style="padding: 15px; background: #f9f9f9; border-radius: 5px; border-left: 4px solid #666;">
                <strong style="color: #666;">Signal Quality:</strong><br>
                <span style="font-size: 18px; font-weight: bold;">{{ content.signal_quality }}%</span>
            </div>
            {% endif %}
        </div>

        {% if content.notes %}
        <div style="margin-top: 20px; padding: 15px; background: #f9f9f9; border-radius: 5px; border-left: 4px solid #666;">
            <strong>Notes:</strong><br>
            <p style="margin-top: 10px;">{{ content.notes }}</p>
        </div>
        {% endif %}
    </div>

    <!-- Raw JSON -->
    <div class="module" style="margin-top: 20px;">
        <h2>Raw JSON</h2>
        <pre style="background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; font-size: 13px; line-height: 1.5; border: 1px solid #ddd;">{{ content_str }}</pre>
    </div>
</div>
{% endblock %}
