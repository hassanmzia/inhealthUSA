{% extends 'healthcare/base.html' %}
{% block title %}Insurance Coverage - {{ patient.full_name }} - InHealth EHR{% endblock %}
{% block breadcrumbs %}&rsaquo; <a href="{% url 'patient_detail' patient.patient_id %}">{{ patient.full_name }}</a> &rsaquo; Insurance Coverage{% endblock %}

{% block content %}
<style>
/* Header Styles */
.detail-header {
    background: white;
    border: 1px solid var(--hairline-color);
    border-radius: 4px;
    padding: 25px;
    margin-bottom: 25px;
}

.detail-header h1 {
    margin: 0 0 10px 0;
    font-size: 28px;
    font-weight: 300;
    color: var(--primary);
}

.detail-header .meta {
    font-size: 14px;
    color: #666;
    margin-bottom: 15px;
}

/* Filter Styles */
.filter-section {
    background: white;
    border: 1px solid var(--hairline-color);
    border-radius: 4px;
    padding: 25px;
    margin-bottom: 25px;
}

.filter-section h3 {
    margin: 0 0 20px 0;
    font-size: 16px;
    font-weight: 600;
    color: var(--primary);
    padding-bottom: 12px;
    border-bottom: 2px solid var(--primary);
}

.form-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
}

.form-group {
    margin-bottom: 15px;
}

.form-label {
    font-size: 14px;
    font-weight: 600;
    color: var(--body-fg);
    margin-bottom: 8px;
    display: block;
}

.select-input,
.text-input {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    font-size: 14px;
    font-family: inherit;
    background: white;
}

.select-input:focus,
.text-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(65, 118, 144, 0.1);
}

.filter-actions {
    display: flex;
    gap: 10px;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid var(--hairline-color);
}

.button-primary {
    background: var(--primary);
    color: white;
    border: none;
    padding: 10px 24px;
    font-size: 14px;
    font-weight: 600;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
}

.button-primary:hover {
    background: #35606f;
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.button-secondary {
    background: #6c757d;
    color: white;
    border: none;
    padding: 10px 24px;
    font-size: 14px;
    font-weight: 600;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
}

.button-secondary:hover {
    background: #5a6268;
}

/* Separator Line */
.content-separator {
    height: 2px;
    background: linear-gradient(to right, var(--primary), transparent);
    margin: 30px 0;
}

/* Section Title */
.section-title {
    font-size: 18px;
    font-weight: 600;
    color: #666;
    margin: 0 0 20px 0;
}

/* Insurance Card Styles */
.insurance-card {
    background: white;
    border: 1px solid var(--hairline-color);
    border-radius: 4px;
    padding: 25px;
    margin-bottom: 20px;
    transition: box-shadow 0.2s;
}

.insurance-card:hover {
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.insurance-card.primary {
    border: 2px solid #5cb85c;
    background: linear-gradient(to right, #f0fff0 0%, white 100%);
}

.insurance-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 20px;
    padding-bottom: 20px;
    border-bottom: 2px solid var(--hairline-color);
}

.insurance-provider {
    font-size: 22px;
    font-weight: 700;
    color: var(--body-fg);
    margin-bottom: 5px;
}

.insurance-type {
    font-size: 14px;
    color: #666;
    margin-bottom: 10px;
}

.badge-primary {
    background: #5cb85c;
    color: white;
    padding: 6px 14px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.badge-secondary {
    background: #999;
    color: white;
    padding: 6px 14px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.badge-active {
    background: #d1ecf1;
    color: #0c5460;
    padding: 6px 14px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.badge-inactive {
    background: #f8d7da;
    color: #721c24;
    padding: 6px 14px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.insurance-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
}

.insurance-detail {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.detail-label {
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    color: #666;
    letter-spacing: 0.5px;
}

.detail-value {
    font-size: 16px;
    font-weight: 600;
    color: var(--body-fg);
}

.coverage-info {
    background: var(--darkened-bg);
    padding: 20px;
    border-radius: 4px;
    margin-top: 20px;
}

.coverage-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 20px;
    text-align: center;
}

.coverage-item {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.coverage-label {
    font-size: 11px;
    color: #666;
    text-transform: uppercase;
    font-weight: 600;
    letter-spacing: 0.5px;
}

.coverage-value {
    font-size: 18px;
    font-weight: 700;
    color: var(--body-fg);
}

/* Empty State */
.empty-state {
    background: white;
    border: 1px solid var(--hairline-color);
    border-radius: 4px;
    padding: 60px 40px;
    text-align: center;
}

.empty-state-icon {
    font-size: 64px;
    color: #ddd;
    margin-bottom: 20px;
}

.empty-state h3 {
    color: #666;
    margin-bottom: 10px;
    font-size: 20px;
    font-weight: 400;
}

.empty-state p {
    color: #999;
    font-size: 14px;
}
</style>

<div class="detail-header">
    <div>
        <h1>Insurance Coverage</h1>
        <div class="meta">
            <strong>Patient:</strong> {{ patient.full_name }} |
            <strong>Patient ID:</strong> {{ patient.patient_id }}
        </div>
        <a href="{% url 'patient_detail' patient.patient_id %}" class="button" style="color: white;">‚Üê Back to Patient</a>
    </div>
</div>

<!-- Filter Section -->
<div class="filter-section">
    <h3>Filter Insurance Policies</h3>
    <form method="GET" action="">
        <div class="form-row">
            <div class="form-group">
                <label class="form-label">Status</label>
                <select name="status" class="select-input">
                    <option value="">All Statuses</option>
                    <option value="active">Active</option>
                    <option value="inactive">Inactive</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Policy Type</label>
                <select name="type" class="select-input">
                    <option value="">All Types</option>
                    <option value="primary">Primary</option>
                    <option value="secondary">Secondary</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Provider Name</label>
                <input type="text" name="provider" class="text-input" placeholder="Search by provider...">
            </div>
        </div>
        <div class="filter-actions">
            <button type="submit" class="button-primary">Apply Filters</button>
            <button type="reset" class="button-secondary" onclick="window.location.href='{% url 'patient_insurance_list' patient.patient_id %}'">Clear Filters</button>
        </div>
    </form>
</div>

<!-- Content Separator -->
<div class="content-separator"></div>

<!-- Insurance Policies -->
{% if insurances %}
    <!-- Primary Insurance -->
    {% if primary_insurance %}
    <h2 class="section-title">Primary Insurance</h2>
    <div class="insurance-card primary">
        <div class="insurance-header">
            <div>
                <div class="insurance-provider">{{ primary_insurance.insurance_provider }}</div>
                <div class="insurance-type">Plan: {{ primary_insurance.plan_name|default:"Standard Plan" }}</div>
                <div style="display:flex;gap:8px;margin-top:8px">
                    <span class="badge-primary">Primary</span>
                    <span class="badge-{% if primary_insurance.is_active %}active{% else %}inactive{% endif %}">
                        {% if primary_insurance.is_active %}Active{% else %}Inactive{% endif %}
                    </span>
                </div>
            </div>
            <a href="{% url 'patient_insurance_detail' patient.patient_id primary_insurance.insurance_id %}" class="button-primary">View Details</a>
        </div>

        <div class="insurance-details">
            <div class="insurance-detail">
                <span class="detail-label">Policy Number</span>
                <span class="detail-value" style="font-family:monospace">{{ primary_insurance.policy_number }}</span>
            </div>
            <div class="insurance-detail">
                <span class="detail-label">Group Number</span>
                <span class="detail-value" style="font-family:monospace">{{ primary_insurance.group_number|default:"‚Äî" }}</span>
            </div>
            <div class="insurance-detail">
                <span class="detail-label">Effective Date</span>
                <span class="detail-value">{{ primary_insurance.effective_date|date:"M d, Y" }}</span>
            </div>
        </div>

        <div class="coverage-info">
            <div class="coverage-grid">
                <div class="coverage-item">
                    <span class="coverage-label">Deductible</span>
                    <span class="coverage-value">${{ primary_insurance.deductible|floatformat:2|default:"‚Äî" }}</span>
                </div>
                <div class="coverage-item">
                    <span class="coverage-label">Co-Pay</span>
                    <span class="coverage-value">${{ primary_insurance.copay|floatformat:2|default:"‚Äî" }}</span>
                </div>
                <div class="coverage-item">
                    <span class="coverage-label">Out-of-Pocket Max</span>
                    <span class="coverage-value">${{ primary_insurance.out_of_pocket_max|floatformat:2|default:"‚Äî" }}</span>
                </div>
                <div class="coverage-item">
                    <span class="coverage-label">Coverage %</span>
                    <span class="coverage-value">{{ primary_insurance.coverage_percentage|default:"‚Äî" }}%</span>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Secondary Insurance -->
    {% if secondary_insurances %}
    <h2 class="section-title" style="margin-top:30px">Secondary Insurance</h2>
    {% for insurance in secondary_insurances %}
    <div class="insurance-card">
        <div class="insurance-header">
            <div>
                <div class="insurance-provider">{{ insurance.insurance_provider }}</div>
                <div class="insurance-type">Plan: {{ insurance.plan_name|default:"Standard Plan" }}</div>
                <div style="display:flex;gap:8px;margin-top:8px">
                    <span class="badge-secondary">Secondary</span>
                    <span class="badge-{% if insurance.is_active %}active{% else %}inactive{% endif %}">
                        {% if insurance.is_active %}Active{% else %}Inactive{% endif %}
                    </span>
                </div>
            </div>
            <a href="{% url 'patient_insurance_detail' patient.patient_id insurance.insurance_id %}" class="button-primary">View Details</a>
        </div>

        <div class="insurance-details">
            <div class="insurance-detail">
                <span class="detail-label">Policy Number</span>
                <span class="detail-value" style="font-family:monospace">{{ insurance.policy_number }}</span>
            </div>
            <div class="insurance-detail">
                <span class="detail-label">Group Number</span>
                <span class="detail-value" style="font-family:monospace">{{ insurance.group_number|default:"‚Äî" }}</span>
            </div>
            <div class="insurance-detail">
                <span class="detail-label">Effective Date</span>
                <span class="detail-value">{{ insurance.effective_date|date:"M d, Y" }}</span>
            </div>
        </div>

        <div class="coverage-info">
            <div class="coverage-grid">
                <div class="coverage-item">
                    <span class="coverage-label">Deductible</span>
                    <span class="coverage-value">${{ insurance.deductible|floatformat:2|default:"‚Äî" }}</span>
                </div>
                <div class="coverage-item">
                    <span class="coverage-label">Co-Pay</span>
                    <span class="coverage-value">${{ insurance.copay|floatformat:2|default:"‚Äî" }}</span>
                </div>
                <div class="coverage-item">
                    <span class="coverage-label">Out-of-Pocket Max</span>
                    <span class="coverage-value">${{ insurance.out_of_pocket_max|floatformat:2|default:"‚Äî" }}</span>
                </div>
                <div class="coverage-item">
                    <span class="coverage-label">Coverage %</span>
                    <span class="coverage-value">{{ insurance.coverage_percentage|default:"‚Äî" }}%</span>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
    {% endif %}

{% else %}
    <div class="empty-state">
        <div class="empty-state-icon">üõ°Ô∏è</div>
        <h3>No Insurance Coverage</h3>
        <p>No insurance policies found for this patient.</p>
    </div>
{% endif %}

{% endblock %}
