{% extends 'healthcare/base.html' %}

{% block title %}IoT Medical Devices - {{ patient.full_name }} - InHealth EHR{% endblock %}

{% block content %}
<div class="breadcrumbs">
    <a href="{% url 'index' %}">Home</a> &rsaquo;
    <a href="{% url 'patient_detail' patient.patient_id %}">{{ patient.full_name }}</a> &rsaquo;
    IoT Devices
</div>

<div class="module">
    <div style="margin-bottom: 20px;">
        <h1>IoT Medical Devices</h1>
        <p style="color: #666; margin-top: 5px;">
            Patient: <strong>{{ patient.full_name }}</strong>
        </p>
    </div>

    {% if messages %}
        {% for message in messages %}
            <div style="background: #dfd; border-left: 4px solid #4caf50; padding: 15px; margin-bottom: 20px;">
                <p style="color: #2e7d32; margin: 0;">{{ message }}</p>
            </div>
        {% endfor %}
    {% endif %}

    <!-- Devices Grid -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
        {% for device in devices %}
            <div style="background: white; border: 1px solid #ccc; border-radius: 5px; padding: 20px; transition: box-shadow 0.2s;">
                <!-- Device Header -->
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; border-bottom: 2px solid #e8e8e8; padding-bottom: 15px;">
                    <div style="flex: 1;">
                        <h3 style="margin: 0 0 5px 0; color: #333;">{{ device.device_name }}</h3>
                        <p style="margin: 0; color: #666; font-size: 14px;">{{ device.device_type }}</p>
                    </div>
                    <div>
                        {% if device.status == 'Active' %}
                            <span style="display: inline-flex; align-items: center; padding: 5px 12px; border-radius: 15px; font-size: 12px; font-weight: bold; background: #dfd; color: #2e7d32;">
                                <span style="display: inline-block; width: 8px; height: 8px; background: #4caf50; border-radius: 50%; margin-right: 5px;"></span>
                                Active
                            </span>
                        {% elif device.status == 'Inactive' %}
                            <span style="display: inline-flex; align-items: center; padding: 5px 12px; border-radius: 15px; font-size: 12px; font-weight: bold; background: #e8e8e8; color: #666;">
                                Inactive
                            </span>
                        {% elif device.status == 'Maintenance' %}
                            <span style="display: inline-flex; align-items: center; padding: 5px 12px; border-radius: 15px; font-size: 12px; font-weight: bold; background: #ffc; color: #856404;">
                                Maintenance
                            </span>
                        {% else %}
                            <span style="display: inline-flex; align-items: center; padding: 5px 12px; border-radius: 15px; font-size: 12px; font-weight: bold; background: #ffefef; color: #ba2121;">
                                Retired
                            </span>
                        {% endif %}
                    </div>
                </div>

                <!-- Device ID -->
                <div style="margin-bottom: 15px;">
                    <p style="margin: 0 0 3px 0; font-size: 11px; color: #999; text-transform: uppercase;">Device ID</p>
                    <p style="margin: 0; font-family: monospace; font-size: 13px; color: #333;">{{ device.device_unique_id }}</p>
                </div>

                <!-- Battery Level -->
                {% if device.battery_level is not None %}
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <p style="margin: 0; font-size: 12px; color: #666; font-weight: bold;">Battery Level</p>
                            <p style="margin: 0; font-size: 12px; font-weight: bold; {% if device.battery_color == 'green' %}color: #4caf50{% elif device.battery_color == 'yellow' %}color: #ff9800{% else %}color: #f44336{% endif %};">
                                {{ device.battery_level }}%
                            </p>
                        </div>
                        <div style="width: 100%; height: 8px; background: #e8e8e8; border-radius: 4px; overflow: hidden;">
                            <div style="height: 100%; {% if device.battery_color == 'green' %}background: #4caf50{% elif device.battery_color == 'yellow' %}background: #ff9800{% else %}background: #f44336{% endif %}; width: {{ device.battery_level }}%; border-radius: 4px;"></div>
                        </div>
                    </div>
                {% endif %}

                <!-- Capabilities -->
                {% if device.capabilities_list %}
                    <div style="margin-bottom: 15px;">
                        <p style="margin: 0 0 8px 0; font-size: 12px; color: #666; font-weight: bold;">Capabilities</p>
                        <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                            {% for capability in device.capabilities_list %}
                                <span style="display: inline-block; padding: 4px 8px; font-size: 11px; font-weight: 500; background: #e7f3ff; color: #0c5282; border: 1px solid #b3d9ff; border-radius: 3px;">
                                    {{ capability }}
                                </span>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}

                <!-- Last Sync -->
                {% if device.last_sync %}
                    <div style="margin-bottom: 15px;">
                        <p style="margin: 0; font-size: 12px; color: #999;">
                            Last synced: <span style="font-weight: 500; color: #666;">{{ device.last_sync|timesince }} ago</span>
                        </p>
                    </div>
                {% endif %}

                <!-- Actions -->
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e8e8e8;">
                    <a href="{% url 'patient_device_detail' patient.patient_id device.device_id %}" style="display: inline-flex; align-items: center; font-size: 14px; font-weight: 500; color: #447e9b; text-decoration: none;">
                        View Details →
                    </a>
                </div>
            </div>
        {% empty %}
            <div style="grid-column: 1 / -1;">
                <div style="text-align: center; padding: 60px 20px; background: #f8f8f8; border-radius: 8px;">
                    <div style="display: inline-flex; align-items: center; justify-content: center; width: 64px; height: 64px; background: #e8e8e8; border-radius: 50%; margin-bottom: 20px;">
                        <span style="font-size: 32px;">⌚</span>
                    </div>
                    <h3 style="margin: 0 0 10px 0; color: #333; font-size: 18px;">No devices registered</h3>
                    <p style="margin: 0; color: #666;">This patient doesn't have any IoT medical devices registered yet.</p>
                </div>
            </div>
        {% endfor %}
    </div>

    <!-- Actions -->
    <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e8e8e8;">
        <a href="{% url 'patient_detail' patient.patient_id %}" class="button" style="color: white;">← Back to Patient</a>
    </div>
</div>
{% endblock %}
