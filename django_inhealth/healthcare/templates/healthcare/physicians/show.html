{% extends 'healthcare/base.html' %}

{% block title %}Dr. {{ physician.full_name }} - InHealth EHR{% endblock %}

{% block breadcrumbs %}
{% if user_role != 'doctor' %}&rsaquo; <a href="{% url 'physician_list' %}">Physicians</a>{% endif %}
&rsaquo; Dr. {{ physician.full_name }}
{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <div>
        <h1 style="margin: 0;">Dr. {{ physician.full_name }}</h1>
        <p style="color: #666; margin-top: 5px; margin-bottom: 5px;">{{ physician.specialty|default:"General Practice" }}</p>
        <p style="color: #666; font-size: 13px; margin: 0;">
            <strong>Provider ID:</strong> {{ physician.provider_id }}
            {% if user_role == 'patient' %} | <strong>Viewing as:</strong> Patient
            {% elif user_role == 'doctor' %} | <strong>Viewing as:</strong> Doctor
            {% else %} | <strong>Viewing as:</strong> Administrator
            {% endif %}
        </p>
    </div>
    {% if can_edit %}
    <div>
        <a href="#" class="button" style="color: white;">Edit Physician</a>
    </div>
    {% endif %}
</div>

<!-- Physician Information -->
<div class="module">
    <h2>Physician Information</h2>
    <table style="width: 100%;">
        <tbody>
            <tr>
                <th style="width: 200px; text-align: left; padding: 10px; background: var(--darkened-bg);">Provider ID:</th>
                <td style="padding: 10px;">{{ physician.provider_id }}</td>
            </tr>
            <tr>
                <th style="text-align: left; padding: 10px; background: var(--darkened-bg);">Full Name:</th>
                <td style="padding: 10px;">Dr. {{ physician.full_name }}</td>
            </tr>
            {% if physician.hospital %}
            <tr>
                <th style="text-align: left; padding: 10px; background: var(--darkened-bg);">Hospital:</th>
                <td style="padding: 10px;">
                    <a href="{% url 'hospital_detail' physician.hospital.hospital_id %}">
                        {{ physician.hospital.name }}
                    </a>
                </td>
            </tr>
            {% endif %}
            <tr>
                <th style="text-align: left; padding: 10px; background: var(--darkened-bg);">Specialty:</th>
                <td style="padding: 10px;">{{ physician.specialty|default:"N/A" }}</td>
            </tr>
            <tr>
                <th style="text-align: left; padding: 10px; background: var(--darkened-bg);">NPI Number:</th>
                <td style="padding: 10px;">{{ physician.npi }}</td>
            </tr>
            <tr>
                <th style="text-align: left; padding: 10px; background: var(--darkened-bg);">License Number:</th>
                <td style="padding: 10px;">{{ physician.license_number|default:"N/A" }}</td>
            </tr>
            {% if physician.department %}
            <tr>
                <th style="text-align: left; padding: 10px; background: var(--darkened-bg);">Department:</th>
                <td style="padding: 10px;">{{ physician.department.department_name }}</td>
            </tr>
            {% endif %}
            <tr>
                <th style="text-align: left; padding: 10px; background: var(--darkened-bg);">Email:</th>
                <td style="padding: 10px;">
                    {% if physician.email %}
                        <a href="mailto:{{ physician.email }}">{{ physician.email }}</a>
                    {% else %}
                        N/A
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th style="text-align: left; padding: 10px; background: var(--darkened-bg);">Phone:</th>
                <td style="padding: 10px;">{{ physician.phone|default:"N/A" }}</td>
            </tr>
            <tr>
                <th style="text-align: left; padding: 10px; background: var(--darkened-bg);">Status:</th>
                <td style="padding: 10px;">
                    <span class="status-badge {% if physician.is_active %}status-active{% else %}status-discontinued{% endif %}">
                        {% if physician.is_active %}Active{% else %}Inactive{% endif %}
                    </span>
                </td>
            </tr>
        </tbody>
    </table>
</div>

<!-- Recent Appointments -->
<div class="module" style="margin-top: 20px;">
    <table>
        <caption>Recent Appointments</caption>
        <thead>
            <tr>
                <th>Date & Time</th>
                <th>Patient</th>
                <th>Type</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for encounter in encounters %}
            <tr>
                <td>{{ encounter.encounter_date|date:"Y-m-d H:i" }}</td>
                <td>
                    <a href="{% url 'patient_detail' encounter.patient.patient_id %}">
                        {{ encounter.patient.full_name }}
                    </a>
                </td>
                <td>{{ encounter.encounter_type }}</td>
                <td>
                    <span class="status-badge status-{{ encounter.status|lower|cut:' ' }}">
                        {{ encounter.status }}
                    </span>
                </td>
                <td>
                    <a href="{% url 'appointment_detail' encounter.encounter_id %}">View</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5" style="text-align: center; color: #666;">
                    No appointments found for this physician.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
