{% extends 'healthcare/base.html' %}
{% block title %}Social History - InHealth EHR{% endblock %}
{% block breadcrumbs %}&rsaquo; Social History{% endblock %}
{% block content %}
<style>
    .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .page-header h1 { margin: 0; font-size: 28px; font-weight: 300; }
    .filter-form { background: white; padding: 15px; margin-bottom: 20px; border: 1px solid var(--hairline-color); border-radius: 4px; }
    .filter-form form { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    .filter-form input[type="text"] { flex: 1; min-width: 250px; padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 14px; }
    .data-module { background: white; border: 1px solid var(--hairline-color); border-radius: 4px; overflow: hidden; }
    .data-module table { width: 100%; border-collapse: collapse; }
    .data-module caption { background: var(--primary); color: var(--header-link-color); padding: 12px 15px; text-align: left; font-weight: 500; font-size: 15px; }
    .data-module thead { background: var(--darkened-bg); }
    .data-module thead th { padding: 10px 15px; text-align: left; font-size: 11px; font-weight: 600; text-transform: uppercase; border-bottom: 1px solid var(--hairline-color); }
    .data-module tbody td { padding: 12px 15px; border-bottom: 1px solid var(--hairline-color); font-size: 13px; }
    .data-module tbody tr:hover { background: var(--darkened-bg); }
    .patient-link { color: var(--link-fg); font-weight: 500; }
    .badge { display: inline-block; padding: 3px 8px; border-radius: 10px; font-size: 11px; font-weight: 500; background: #e2e3e5; color: #383d41; }
    .empty-state { text-align: center; padding: 60px 20px; color: #999; }
    .empty-state svg { width: 80px; height: 80px; margin: 0 auto 20px; opacity: 0.3; }
    .stats-bar { background: white; border: 1px solid var(--hairline-color); border-radius: 4px; padding: 15px 20px; margin-bottom: 20px; display: flex; justify-content: space-around; }
    .stat-item { text-align: center; }
    .stat-value { font-size: 24px; font-weight: 600; color: var(--primary); }
    .stat-label { font-size: 12px; color: #666; text-transform: uppercase; letter-spacing: 0.5px; }
</style>

<div class="page-header">
    <h1>Social History</h1>
    <div><a href="/admin/healthcare/socialhistory/add/" class="button">+ New Record</a></div>
</div>

<div class="stats-bar">
    <div class="stat-item"><div class="stat-value">{{ social_histories|length }}</div><div class="stat-label">Total Records</div></div>
</div>

<div class="filter-form">
    <form method="get">
        <input type="text" name="search" value="{{ search }}" placeholder="Search by patient name...">
        <button type="submit" class="button">Search</button>
        {% if search %}<a href="{% url 'social_history_list' %}" class="button button-secondary">Clear</a>{% endif %}
    </form>
</div>

<div class="data-module">
    <table>
        <caption>{% if search %}Search Results for "{{ search }}"{% else %}All Social History{% endif %}</caption>
        <thead>
            <tr><th>History ID</th><th>Patient</th><th>Smoking Status</th><th>Alcohol Use</th><th>Marital Status</th><th>Occupation</th><th>Recorded Date</th><th>Actions</th></tr>
        </thead>
        <tbody>
            {% for history in social_histories %}
            <tr>
                <td><strong>{{ history.social_history_id }}</strong></td>
                <td><a href="{% url 'patient_detail' history.patient.patient_id %}" class="patient-link">{{ history.patient.full_name }}</a></td>
                <td>{% if history.smoking_status %}<span class="badge">{{ history.smoking_status }}</span>{% else %}—{% endif %}</td>
                <td>{{ history.alcohol_use|default:"—" }}</td>
                <td>{% if history.marital_status %}<span class="badge">{{ history.marital_status }}</span>{% else %}—{% endif %}</td>
                <td>{{ history.occupation|default:"—" }}</td>
                <td>{{ history.recorded_date|date:"M d, Y" }}</td>
                <td><a href="{% url 'social_history_detail' history.social_history_id %}" style="color: var(--link-fg); font-weight: 500;">View</a></td>
            </tr>
            {% empty %}
            <tr><td colspan="8"><div class="empty-state"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg><p>{% if search %}No records found matching "{{ search }}"{% else %}No social history recorded yet{% endif %}</p></div></td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<p style="margin-top: 20px; font-size: 12px; color: #666;"><strong>Tip:</strong> Use the <a href="/admin/healthcare/socialhistory/">Django Admin Panel</a> for advanced management operations.</p>
{% endblock %}
