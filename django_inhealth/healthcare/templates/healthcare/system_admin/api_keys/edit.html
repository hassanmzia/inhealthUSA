{% extends 'healthcare/base.html' %}

{% block title %}Edit {{ api_key.name }} - InHealth EHR{% endblock %}

{% block content %}
<div class="breadcrumbs">
    <a href="{% url 'index' %}">Home</a> &rsaquo;
    <a href="{% url 'system_admin_dashboard' %}">System Admin Dashboard</a> &rsaquo;
    <a href="{% url 'api_key_list' %}">API Keys</a> &rsaquo;
    <a href="{% url 'api_key_detail' api_key.api_key_id %}">{{ api_key.name }}</a> &rsaquo;
    Edit
</div>

<div class="module">
    <h1>‚úèÔ∏è Edit API Key</h1>

    <form method="post" style="max-width: 800px;">
        {% csrf_token %}

        <!-- Basic Information -->
        <div style="margin-bottom: 20px;">
            <h2 style="border-bottom: 2px solid #667eea; padding-bottom: 10px;">Basic Information</h2>

            <div style="margin: 15px 0;">
                <label for="name" style="display: block; margin-bottom: 5px; font-weight: bold;">
                    Name: <span style="color: red;">*</span>
                </label>
                <input type="text" id="name" name="name" value="{{ api_key.name }}" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
            </div>

            <div style="margin: 15px 0;">
                <label for="description" style="display: block; margin-bottom: 5px; font-weight: bold;">
                    Description:
                </label>
                <textarea id="description" name="description" rows="3" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">{{ api_key.description }}</textarea>
            </div>
        </div>

        <!-- Permissions -->
        <div style="margin-bottom: 20px;">
            <h2 style="border-bottom: 2px solid #667eea; padding-bottom: 10px;">Permissions</h2>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                <label style="display: flex; align-items: center; padding: 10px; background: #f8f9fa; border-radius: 4px; cursor: pointer;">
                    <input type="checkbox" name="perm_vitals" value="1" {% if 'vitals' in api_key.permissions %}checked{% endif %} style="margin-right: 10px;">
                    <span>üìä Vital Signs</span>
                </label>
                <label style="display: flex; align-items: center; padding: 10px; background: #f8f9fa; border-radius: 4px; cursor: pointer;">
                    <input type="checkbox" name="perm_patients" value="1" {% if 'patients' in api_key.permissions %}checked{% endif %} style="margin-right: 10px;">
                    <span>üë• Patients</span>
                </label>
                <label style="display: flex; align-items: center; padding: 10px; background: #f8f9fa; border-radius: 4px; cursor: pointer;">
                    <input type="checkbox" name="perm_devices" value="1" {% if 'devices' in api_key.permissions %}checked{% endif %} style="margin-right: 10px;">
                    <span>üì± IoT Devices</span>
                </label>
                <label style="display: flex; align-items: center; padding: 10px; background: #f8f9fa; border-radius: 4px; cursor: pointer;">
                    <input type="checkbox" name="perm_encounters" value="1" {% if 'encounters' in api_key.permissions %}checked{% endif %} style="margin-right: 10px;">
                    <span>üè• Encounters</span>
                </label>
            </div>
        </div>

        <!-- Security Settings -->
        <div style="margin-bottom: 20px;">
            <h2 style="border-bottom: 2px solid #667eea; padding-bottom: 10px;">Security Settings</h2>

            <div style="margin: 15px 0;">
                <label for="rate_limit" style="display: block; margin-bottom: 5px; font-weight: bold;">
                    Rate Limit (requests per hour):
                </label>
                <input type="number" id="rate_limit" name="rate_limit" value="{{ api_key.rate_limit }}" min="1" max="10000" style="width: 200px; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
            </div>

            <div style="margin: 15px 0;">
                <label for="ip_whitelist" style="display: block; margin-bottom: 5px; font-weight: bold;">
                    IP Whitelist (optional):
                </label>
                <input type="text" id="ip_whitelist" name="ip_whitelist" value="{{ api_key.ip_whitelist }}" placeholder="192.168.1.100, 10.0.0.50" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                <small style="color: #666;">Comma-separated list of IP addresses</small>
            </div>

            <div style="margin: 15px 0;">
                <label for="expires_at" style="display: block; margin-bottom: 5px; font-weight: bold;">
                    Expiration Date (optional):
                </label>
                <input type="date" id="expires_at" name="expires_at" value="{% if api_key.expires_at %}{{ api_key.expires_at|date:'Y-m-d' }}{% endif %}" style="padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
            </div>

            <div style="margin: 15px 0;">
                <label for="status" style="display: block; margin-bottom: 5px; font-weight: bold;">
                    Status:
                </label>
                <select id="status" name="status" style="padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="active" {% if api_key.status == 'active' %}selected{% endif %}>Active</option>
                    <option value="inactive" {% if api_key.status == 'inactive' %}selected{% endif %}>Inactive</option>
                    <option value="revoked" {% if api_key.status == 'revoked' %}selected{% endif %} disabled>Revoked</option>
                </select>
            </div>
        </div>

        <!-- Submit Buttons -->
        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd; display: flex; gap: 10px;">
            <button type="submit" style="padding: 12px 30px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px;">
                ‚úì Save Changes
            </button>
            <a href="{% url 'api_key_detail' api_key.api_key_id %}" style="padding: 12px 30px; background: #6c757d; color: white; text-decoration: none; border-radius: 4px; display: inline-block;">
                Cancel
            </a>
        </div>
    </form>
</div>
{% endblock %}
