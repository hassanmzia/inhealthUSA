{% extends 'healthcare/base.html' %}
{% block title %}Family History - InHealth EHR{% endblock %}
{% block breadcrumbs %}&rsaquo; Family History{% endblock %}
{% block content %}
<style>
    .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .page-header h1 { margin: 0; font-size: 28px; font-weight: 300; }
    .filter-form { background: white; padding: 15px; margin-bottom: 20px; border: 1px solid var(--hairline-color); border-radius: 4px; }
    .filter-form form { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    .filter-form label { font-size: 13px; font-weight: 600; color: var(--body-fg); }
    .filter-form select, .filter-form input[type="text"] { padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 14px; }
    .filter-form input[type="text"] { flex: 1; min-width: 250px; }
    .data-module { background: white; border: 1px solid var(--hairline-color); border-radius: 4px; overflow: hidden; }
    .data-module table { width: 100%; border-collapse: collapse; }
    .data-module caption { background: var(--primary); color: var(--header-link-color); padding: 12px 15px; text-align: left; font-weight: 500; font-size: 15px; }
    .data-module thead { background: var(--darkened-bg); }
    .data-module thead th { padding: 10px 15px; text-align: left; font-size: 11px; font-weight: 600; text-transform: uppercase; color: var(--body-fg); border-bottom: 1px solid var(--hairline-color); }
    .data-module tbody td { padding: 12px 15px; border-bottom: 1px solid var(--hairline-color); font-size: 13px; }
    .data-module tbody tr:hover { background: var(--darkened-bg); }
    .condition-name { font-weight: 600; color: var(--body-fg); }
    .patient-link { color: var(--link-fg); font-weight: 500; }
    .relationship-badge { display: inline-block; padding: 3px 8px; border-radius: 10px; font-size: 11px; font-weight: 500; background: #d1ecf1; color: #0c5460; }
    .status-indicator { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 5px; }
    .status-indicator.alive { background: #28a745; }
    .status-indicator.deceased { background: #6c757d; }
    .empty-state { text-align: center; padding: 60px 20px; color: #999; }
    .empty-state svg { width: 80px; height: 80px; margin: 0 auto 20px; opacity: 0.3; }
    .stats-bar { background: white; border: 1px solid var(--hairline-color); border-radius: 4px; padding: 15px 20px; margin-bottom: 20px; display: flex; justify-content: space-around; }
    .stat-item { text-align: center; }
    .stat-value { font-size: 24px; font-weight: 600; color: var(--primary); }
    .stat-label { font-size: 12px; color: #666; text-transform: uppercase; letter-spacing: 0.5px; }
</style>

<div class="page-header">
    <h1>Family History</h1>
    <div><a href="/admin/healthcare/familyhistory/add/" class="button">+ New Record</a></div>
</div>

<div class="stats-bar">
    <div class="stat-item"><div class="stat-value">{{ family_histories|length }}</div><div class="stat-label">Total Records</div></div>
</div>

<div class="filter-form">
    <form method="get">
        <input type="text" name="search" value="{{ search }}" placeholder="Search by patient name or condition...">
        <label for="relationship">Relationship:</label>
        <select name="relationship" id="relationship">
            <option value="">All Relationships</option>
            <option value="Father" {% if relationship == 'Father' %}selected{% endif %}>Father</option>
            <option value="Mother" {% if relationship == 'Mother' %}selected{% endif %}>Mother</option>
            <option value="Brother" {% if relationship == 'Brother' %}selected{% endif %}>Brother</option>
            <option value="Sister" {% if relationship == 'Sister' %}selected{% endif %}>Sister</option>
            <option value="Grandfather" {% if relationship == 'Grandfather' %}selected{% endif %}>Grandfather</option>
            <option value="Grandmother" {% if relationship == 'Grandmother' %}selected{% endif %}>Grandmother</option>
        </select>
        <button type="submit" class="button">Filter</button>
        {% if search or relationship %}<a href="{% url 'family_history_list' %}" class="button button-secondary">Clear</a>{% endif %}
    </form>
</div>

<div class="data-module">
    <table>
        <caption>{% if search %}Search Results for "{{ search }}"{% elif relationship %}{{ relationship }} Records{% else %}All Family History{% endif %}</caption>
        <thead>
            <tr><th>History ID</th><th>Patient</th><th>Relationship</th><th>Condition</th><th>Age at Diagnosis</th><th>Status</th><th>Recorded Date</th><th>Actions</th></tr>
        </thead>
        <tbody>
            {% for history in family_histories %}
            <tr>
                <td><strong>{{ history.family_history_id }}</strong></td>
                <td><a href="{% url 'patient_detail' history.patient.patient_id %}" class="patient-link">{{ history.patient.full_name }}</a></td>
                <td><span class="relationship-badge">{{ history.relationship }}</span></td>
                <td class="condition-name">{{ history.condition }}</td>
                <td>{% if history.age_at_diagnosis %}{{ history.age_at_diagnosis }} years{% else %}â€”{% endif %}</td>
                <td>
                    <span class="status-indicator {% if history.is_alive %}alive{% else %}deceased{% endif %}"></span>
                    {% if history.is_alive %}Living{% else %}Deceased{% if history.age_at_death %} ({{ history.age_at_death }}){% endif %}{% endif %}
                </td>
                <td>{{ history.recorded_date|date:"M d, Y" }}</td>
                <td><a href="{% url 'family_history_detail' history.family_history_id %}" style="color: var(--link-fg); font-weight: 500;">View</a></td>
            </tr>
            {% empty %}
            <tr><td colspan="8"><div class="empty-state"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg><p>{% if search %}No records found matching "{{ search }}"{% else %}No family history recorded yet{% endif %}</p></div></td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<p style="margin-top: 20px; font-size: 12px; color: #666;"><strong>Tip:</strong> Use the <a href="/admin/healthcare/familyhistory/">Django Admin Panel</a> for advanced management operations.</p>
{% endblock %}
